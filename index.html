<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Decision Assistant Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="crisis-modal.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="white" opacity="0.1"><animate attributeName="r" values="2;4;2" dur="3s" repeatCount="indefinite"/></circle><circle cx="80" cy="80" r="2" fill="white" opacity="0.1"><animate attributeName="r" values="2;4;2" dur="2s" repeatCount="indefinite"/></circle><circle cx="50" cy="50" r="2" fill="white" opacity="0.1"><animate attributeName="r" values="2;4;2" dur="4s" repeatCount="indefinite"/></circle></svg>');
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(20px);
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 3em;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient 3s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            position: relative;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .context-factors {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .factor-card {
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .factor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .factor-card:hover::before {
            left: 100%;
        }

        .factor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .factor-card.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.05);
        }

        .mood-energy {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .mood-slider, .energy-slider {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            margin: 15px 0;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .generate-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .generate-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.3);
        }

        .results-section {
            margin-top: 40px;
            display: none;
        }

        .result-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .decision-title {
            font-size: 1.6em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .decision-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .context-analysis {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        
        .confidence-meter {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
            transition: width 1s ease-out;
            border-radius: 6px;
        }

        .time-context {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-radius: 12px;
        }

        .pulse {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #4caf50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        .history-section {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 2.2em;
            }
            
            .context-factors {
                grid-template-columns: 1fr;
            }
            
            .mood-energy {
                grid-template-columns: 1fr;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
        }

        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* EXTRA CSS AWESOMENESS */
        
        .glow-effect {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
            to { box-shadow: 0 0 30px rgba(118, 75, 162, 0.8), 0 0 40px rgba(240, 147, 251, 0.4); }
        }

        .neon-text {
            text-shadow: 0 0 10px #667eea, 0 0 20px #667eea, 0 0 30px #667eea, 
                         0 0 40px #764ba2, 0 0 70px #764ba2, 0 0 80px #764ba2;
            animation: neon-flicker 1.5s infinite alternate;
        }

        @keyframes neon-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .rotate-scale {
            animation: rotateScale 0.6s ease-out;
        }

        @keyframes rotateScale {
            0% { transform: rotate(0deg) scale(0); opacity: 0; }
            50% { transform: rotate(180deg) scale(1.2); opacity: 1; }
            100% { transform: rotate(360deg) scale(1); opacity: 1; }
        }

        .rainbow-border {
            background: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            background-size: 400% 400%;
            animation: rainbow 3s ease infinite;
            padding: 3px;
            border-radius: 15px;
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .matrix-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.1;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 255, 0, 0.1) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 255, 0, 0.1) 3px
            );
            animation: matrix 20s linear infinite;
        }

        @keyframes matrix {
            0% { background-position: 0 0; }
            100% { background-position: 0 100px; }
        }

        .holographic {
            background: linear-gradient(45deg, 
                #ff0080, #ff8c00, #ffd700, #00ff00, #00ffff, #0080ff, #8000ff);
            background-size: 200% 200%;
            animation: holographic 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @keyframes holographic {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .cyber-button {
            background: linear-gradient(45deg, #00ff88, #00ffff, #ff00ff);
            background-size: 200% 200%;
            animation: cyber-pulse 2s ease infinite;
            border: 2px solid #00ffff;
            position: relative;
            overflow: hidden;
        }

        .cyber-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: cyber-sweep 3s infinite;
        }

        @keyframes cyber-pulse {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes cyber-sweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .aurora {
            background: linear-gradient(45deg, #00ff88, #00ffff, #ff00ff, #ffff00, #ff8800);
            background-size: 400% 400%;
            animation: aurora 10s ease infinite;
            opacity: 0.3;
            mix-blend-mode: screen;
        }

        @keyframes aurora {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }

        .pixel-art {
            image-rendering: pixelated;
            font-family: 'Courier New', monospace;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
        }

        .vaporwave {
            background: linear-gradient(45deg, #ff6ec7, #7873f5, #4fc3f7);
            animation: vaporwave 4s ease infinite;
        }

        @keyframes vaporwave {
            0%, 100% { transform: perspective(500px) rotateX(0deg); }
            50% { transform: perspective(500px) rotateX(5deg); }
        }

        .glitch {
            position: relative;
            animation: glitch 2s infinite;
        }

        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .glitch::before {
            animation: glitch-1 0.5s infinite;
            color: #00ffff;
            z-index: -1;
        }

        .glitch::after {
            animation: glitch-2 0.5s infinite;
            color: #ff00ff;
            z-index: -2;
        }

        @keyframes glitch {
            0%, 100% { text-shadow: 2px 2px 0px rgba(255,0,0,0.5); }
            25% { text-shadow: -2px 2px 0px rgba(0,255,0,0.5); }
            50% { text-shadow: 2px -2px 0px rgba(0,0,255,0.5); }
            75% { text-shadow: -2px -2px 0px rgba(255,255,0,0.5); }
        }

        @keyframes glitch-1 {
            0%, 100% { clip-path: inset(0 0 0 0); transform: translate(0); }
            20% { clip-path: inset(20% 0 30% 0); transform: translate(-2px, 2px); }
            40% { clip-path: inset(50% 0 20% 0); transform: translate(2px, -2px); }
            60% { clip-path: inset(10% 0 60% 0); transform: translate(-1px, 1px); }
            80% { clip-path: inset(80% 0 5% 0); transform: translate(1px, -1px); }
        }

        @keyframes glitch-2 {
            0%, 100% { clip-path: inset(0 0 0 0); transform: translate(0); }
            20% { clip-path: inset(60% 0 10% 0); transform: translate(2px, -1px); }
            40% { clip-path: inset(20% 0 50% 0); transform: translate(-2px, 1px); }
            60% { clip-path: inset(30% 0 40% 0); transform: translate(1px, -2px); }
            80% { clip-path: inset(5% 0 80% 0); transform: translate(-1px, 2px); }
        }

        .retro-grid {
            background-image: 
                linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: retro-move 10s linear infinite;
        }

        @keyframes retro-move {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }

        .magnetic {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .magnetic:hover {
            transform: scale(1.05) rotate(1deg);
        }

        .liquid-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 30px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .liquid-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .liquid-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .typewriter {
            overflow: hidden;
            border-right: 3px solid #667eea;
            white-space: nowrap;
            animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
        }

        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: #667eea; }
        }

        /* New Tool Styles */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tool-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .matrix-input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .priority-sliders {
            margin: 15px 0;
        }

        .priority-sliders label {
            display: block;
            margin: 10px 0 5px 0;
            font-size: 14px;
        }

        .priority-sliders input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }

        .motivation-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .quote-card, .challenge-card, .achievement-card, .mood-tracker {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e0e0e0;
        }

        #daily-quote {
            font-style: italic;
            font-size: 18px;
            margin: 15px 0;
            color: #333;
        }

        #daily-challenge {
            font-size: 16px;
            margin: 15px 0;
            color: #333;
        }

        #achievements-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .achievement-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        #mood-entry {
            width: 100%;
            height: 80px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            resize: vertical;
        }

        #mood-history {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .mood-entry-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }

        .mood-date {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        #insights-container {
            margin-top: 20px;
        }

        .insight-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .insight-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .insight-content {
            color: #666;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="matrix-rain"></div>
    <div class="aurora"></div>
    <div class="container glass-morphism">
        <div class="header">
            <h1 class="neon-text holographic floating">Decision Assistant Pro</h1>
            <p class="subtitle typewriter">Advanced context-aware decision making with mood tracking and history</p>
            <div style="margin: 15px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                <p style="color: #fff; font-size: 14px; margin: 0;">ü§ñ <strong>Built-in Gemini AI</strong> - Intelligent recommendations powered by Google's AI</p>
            </div>
        </div>
        
        <div class="nav-tabs">
            <button class="tab active" onclick="switchTab('assistant')">Assistant</button>
            <button class="tab" onclick="switchTab('history')">History</button>
            <button class="tab" onclick="switchTab('compare')">Compare</button>
            <button class="tab" onclick="switchTab('stats')">Statistics</button>
            <button class="tab" onclick="switchTab('tools')">Tools</button>
            <button class="tab" onclick="switchTab('motivation')">Motivation</button>
        </div>
        
        <!-- Assistant Tab -->
        <div id="assistant-tab" class="tab-content active">
            <div class="input-section">
                <div class="form-group">
                    <label for="decision">What decision are you trying to make?</label>
                    <textarea id="decision" placeholder="e.g., Should I accept this job offer? What should I have for dinner? Should I start this project? Should I move to a new city?"></textarea>
                </div>
                
                <div class="mood-energy">
                    <div class="mood-slider">
                        <label>Current Mood: <span id="mood-value">5</span>/10</label>
                        <input type="range" class="slider" id="mood-slider" min="1" max="10" value="5">
                        <small>From üòî to üòä</small>
                    </div>
                    <div class="energy-slider">
                        <label>Energy Level: <span id="energy-value">5</span>/10</label>
                        <input type="range" class="slider" id="energy-slider" min="1" max="10" value="5">
                        <small>From üò¥ to ‚ö°</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Select relevant context factors:</label>
                    <div class="context-factors">
                        <div class="factor-card magnetic" data-factor="time">
                            <strong class="holographic">‚è∞ Time Pressure</strong>
                            <div>Urgent vs. Flexible</div>
                        </div>
                        <div class="factor-card magnetic" data-factor="budget">
                            <strong class="holographic">üí∞ Budget</strong>
                            <div>Financial constraints</div>
                        </div>
                        <div class="factor-card magnetic" data-factor="energy">
                            <strong class="holographic">‚ö° Energy Level</strong>
                            <div>Current mental/physical state</div>
                        </div>
                        <div class="factor-card magnetic" data-factor="social">
                            <strong class="holographic">üë• Social Impact</strong>
                            <div>How it affects others</div>
                        </div>
                        <div class="factor-card magnetic" data-factor="risk">
                            <strong class="holographic">üé≤ Risk Tolerance</strong>
                            <div>Safety vs. Adventure</div>
                        </div>
                        <div class="factor-card magnetic" data-factor="growth">
                            <strong class="holographic">üå± Personal Growth</strong>
                            <div>Learning opportunity</div>
                        </div>
                        <div class="factor-card magnetic" data-factor="health">
                            <strong class="holographic">üè• Health</strong>
                            <div>Physical & mental wellbeing</div>
                        </div>
                        <div class="factor-card magnetic" data-factor="environment">
                            <strong class="holographic">üåç Environment</strong>
                            <div>Ecological impact</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="priority">What's most important right now?</label>
                    <select id="priority">
                        <option value="">Select priority...</option>
                        <option value="efficiency">‚ö° Efficiency & Speed</option>
                        <option value="quality">üéØ Quality & Excellence</option>
                        <option value="balance">‚öñÔ∏è Balance & Well-being</option>
                        <option value="growth">üìà Learning & Growth</option>
                        <option value="connection">‚ù§Ô∏è Relationships & Connection</option>
                        <option value="security">üõ°Ô∏è Security & Stability</option>
                        <option value="creativity">üé® Creativity & Innovation</option>
                        <option value="impact">üåü Impact & Legacy</option>
                    </select>
                </div>
                
                <button class="generate-btn cyber-button liquid-button magnetic" onclick="generateDecision()">Generate Context-Aware Suggestion</button>
                <div class="loading-spinner" id="loading"></div>
            </div>
            
            <div class="results-section" id="results">
                <!-- Results will be populated here -->
            </div>
        </div>
        
        <!-- History Tab -->
        <div id="history-tab" class="tab-content">
            <h2>Decision History</h2>
            <div class="history-section" id="history-list">
                <!-- History items will be populated here -->
            </div>
            <button class="generate-btn" onclick="clearHistory()">Clear History</button>
        </div>
        
        <!-- Compare Tab -->
        <div id="compare-tab" class="tab-content">
            <h2>Compare Decisions</h2>
            <div class="comparison-grid">
                <div class="comparison-item">
                    <h3>Decision 1</h3>
                    <textarea id="compare1" placeholder="Enter first decision..."></textarea>
                </div>
                <div class="comparison-item">
                    <h3>Decision 2</h3>
                    <textarea id="compare2" placeholder="Enter second decision..."></textarea>
                </div>
            </div>
            <button class="generate-btn" onclick="compareDecisions()">Compare Decisions</button>
            <div id="comparison-results"></div>
        </div>
        
        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content">
            <h2>Your Decision Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-decisions">0</div>
                    <div class="stat-label">Total Decisions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avg-confidence">0%</div>
                    <div class="stat-label">Avg Confidence</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="most-common">-</div>
                    <div class="stat-label">Most Common Type</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="current-streak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Decision Insights</h3>
            <div id="insights-container">
                <!-- Insights will be populated here -->
            </div>
        </div>
        
        <!-- Tools Tab -->
        <div id="tools-tab" class="tab-content">
            <h2>Decision Tools & Utilities</h2>
            
            <div class="tools-grid">
                <div class="tool-card magnetic">
                    <h3>üéØ Decision Matrix</h3>
                    <p>Compare options across multiple criteria</p>
                    <div id="matrix-tool">
                        <input type="text" id="option1" placeholder="Option 1" class="matrix-input">
                        <input type="text" id="option2" placeholder="Option 2" class="matrix-input">
                        <input type="text" id="option3" placeholder="Option 3" class="matrix-input">
                        <button class="cyber-button" onclick="createMatrix()">Create Matrix</button>
                        <div id="matrix-result"></div>
                    </div>
                </div>
                
                <div class="tool-card magnetic">
                    <h3>‚è∞ Time Tracker</h3>
                    <p>Track time spent on decisions</p>
                    <div id="time-tool">
                        <button class="cyber-button" onclick="startTimer()">Start Timer</button>
                        <button class="cyber-button" onclick="stopTimer()">Stop Timer</button>
                        <div id="timer-display">00:00:00</div>
                        <div id="time-log"></div>
                    </div>
                </div>
                
                <div class="tool-card magnetic">
                    <h3>üé≤ Random Choice</h3>
                    <p>Let fate decide between options</p>
                    <div id="random-tool">
                        <textarea id="random-options" placeholder="Enter options (one per line)"></textarea>
                        <button class="cyber-button" onclick="randomChoice()">Choose Randomly</button>
                        <div id="random-result"></div>
                    </div>
                </div>
                
                <div class="tool-card magnetic">
                    <h3>üìä Priority Calculator</h3>
                    <p>Calculate decision priority scores</p>
                    <div id="priority-tool">
                        <input type="text" id="priority-decision" placeholder="Decision to prioritize">
                        <div class="priority-sliders">
                            <label>Urgency: <span id="urgency-value">5</span>/10</label>
                            <input type="range" id="urgency-slider" min="1" max="10" value="5">
                            <label>Importance: <span id="importance-value">5</span>/10</label>
                            <input type="range" id="importance-slider" min="1" max="10" value="5">
                            <label>Effort: <span id="effort-value">5</span>/10</label>
                            <input type="range" id="effort-slider" min="1" max="10" value="5">
                        </div>
                        <button class="cyber-button" onclick="calculatePriority()">Calculate Priority</button>
                        <div id="priority-result"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Motivation Tab -->
        <div id="motivation-tab" class="tab-content">
            <h2>Daily Motivation & Inspiration</h2>
            
            <div class="motivation-container">
                <div class="quote-card glow-effect">
                    <h3>üí≠ Daily Wisdom</h3>
                    <div id="daily-quote">Loading quote...</div>
                    <button class="cyber-button" onclick="newQuote()">New Quote</button>
                </div>
                
                <div class="challenge-card">
                    <h3>üéØ Today's Challenge</h3>
                    <div id="daily-challenge">Loading challenge...</div>
                    <button class="cyber-button" onclick="completeChallenge()">Complete Challenge</button>
                </div>
                
                <div class="achievement-card">
                    <h3>üèÜ Achievements</h3>
                    <div id="achievements-list">
                        <!-- Achievements will be populated here -->
                    </div>
                </div>
                
                <div class="mood-tracker">
                    <h3>üòä Mood Journal</h3>
                    <textarea id="mood-entry" placeholder="How are you feeling today?"></textarea>
                    <button class="cyber-button" onclick="saveMoodEntry()">Save Mood Entry</button>
                    <div id="mood-history"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced decision database with more categories
        const decisionPatterns = {
            career: {
                keywords: ['job', 'work', 'career', 'offer', 'promotion', 'quit', 'freelance', 'salary', 'office'],
                suggestions: [
                    {
                        title: "Strategic Career Move",
                        context: "Consider long-term growth potential vs immediate benefits",
                        alternatives: ["Negotiate better terms", "Seek counter-offer", "Explore parallel opportunities", "Skill development first"],
                        confidence: 85
                    },
                    {
                        title: "Work-Life Balance Priority",
                        context: "Evaluate impact on personal time and wellbeing",
                        alternatives: ["Flexible arrangement", "Part-time transition", "Remote work options", "Sabbatical consideration"],
                        confidence: 75
                    },
                    {
                        title: "Career Pivot Strategy",
                        context: "Major career change requires careful planning",
                        alternatives: ["Gradual transition", "Skill acquisition phase", "Network building", "Financial buffer creation"],
                        confidence: 70
                    }
                ]
            },
            food: {
                keywords: ['eat', 'food', 'dinner', 'lunch', 'breakfast', 'cook', 'restaurant', 'meal', 'recipe', 'snack', 'hungry'],
                suggestions: [
                    {
                        title: "Energy-Optimized Meal",
                        context: "Based on current time and energy needs",
                        alternatives: [
                            "Grilled chicken with quinoa and roasted vegetables",
                            "Salmon with sweet potato and steamed broccoli",
                            "Greek yogurt parfait with berries and granola",
                            "Whole grain pasta with lean turkey and marinara"
                        ],
                        confidence: 90
                    },
                    {
                        title: "Social Dining Experience",
                        context: "Consider social context and enjoyment factor",
                        alternatives: [
                            "Trendy fusion restaurant with shared plates",
                            "Cozy Italian trattoria with homemade pasta",
                            "Vibrant Mexican cantina with fresh guacamole",
                            "Local farm-to-table bistro with seasonal menu"
                        ],
                        confidence: 80
                    },
                    {
                        title: "Nutrition-Focused Choice",
                        context: "Prioritize health and dietary requirements",
                        alternatives: [
                            "Buddha bowl with chickpeas, avocado, and tahini",
                            "Kale salad with grilled tofu and hemp seeds",
                            "Overnight oats with chia seeds and fresh fruit",
                            "Stir-fried vegetables with brown rice and edamame"
                        ],
                        confidence: 85
                    },
                    {
                        title: "Quick & Convenient Option",
                        context: "When time is limited but quality matters",
                        alternatives: [
                            "Protein smoothie with spinach and banana",
                            "Turkey and avocado wrap with whole grain tortilla",
                            "Pre-made grain bowl from healthy fast casual",
                            "Hard-boiled eggs with whole grain toast"
                        ],
                        confidence: 75
                    },
                    {
                        title: "Comfort Food Upgrade",
                        context: "Satisfying cravings with healthier alternatives",
                        alternatives: [
                            "Zucchini noodles with turkey meatballs",
                            "Cauliflower crust pizza with fresh vegetables",
                            "Sweet potato fries with air-fried chicken tenders",
                            "Lentil shepherd's pie with mashed cauliflower"
                        ],
                        confidence: 70
                    }
                ]
            },
            personal: {
                keywords: ['relationship', 'friend', 'family', 'move', 'travel', 'health', 'exercise', 'dating', 'marriage', 'breakup', 'relocate'],
                suggestions: [
                    {
                        title: "Holistic Life Decision",
                        context: "Balance multiple life domains",
                        alternatives: [
                            "Create a pros/cons list with weighted priorities",
                            "Try a 30-day trial period before committing",
                            "Consult with trusted friends or family members",
                            "Journal about your values and long-term vision"
                        ],
                        confidence: 70
                    },
                    {
                        title: "Relationship Investment",
                        context: "Consider emotional investment and compatibility",
                        alternatives: [
                            "Schedule weekly relationship check-in conversations",
                            "Try couples therapy or relationship coaching",
                            "Plan regular date nights and new experiences together",
                            "Create shared goals and vision board for the future"
                        ],
                        confidence: 75
                    },
                    {
                        title: "Personal Growth Journey",
                        context: "Focus on self-development and healing",
                        alternatives: [
                            "Start daily meditation or mindfulness practice",
                            "Join a workshop or class in something you're curious about",
                            "Volunteer for a cause you care about",
                            "Begin a gratitude journaling practice"
                        ],
                        confidence: 80
                    },
                    {
                        title: "Relocation Decision",
                        context: "Major move requires comprehensive planning",
                        alternatives: [
                            "Take an extended trip to potential new city first",
                            "Research job market and cost of living thoroughly",
                            "Connect with locals through online communities",
                            "Create a detailed moving budget and timeline"
                        ],
                        confidence: 85
                    },
                    {
                        title: "Social Connection Enhancement",
                        context: "Build meaningful relationships and community",
                        alternatives: [
                            "Join local clubs or interest-based meetups",
                            "Reach out to old friends you've lost touch with",
                            "Host small gatherings or dinner parties",
                            "Take classes or workshops to meet like-minded people"
                        ],
                        confidence: 75
                    }
                ]
            },
            creative: {
                keywords: ['project', 'create', 'art', 'write', 'music', 'design', 'build', 'invent', 'startup', 'paint', 'novel', 'app'],
                suggestions: [
                    {
                        title: "Creative Momentum Strategy",
                        context: "Optimize for inspiration and productivity",
                        alternatives: [
                            "Start with a 15-minute daily creative habit",
                            "Join a local makerspace or creative community",
                            "Set up a dedicated creative workspace",
                            "Try the 'two-minute rule' for creative blocks"
                        ],
                        confidence: 85
                    },
                    {
                        title: "Innovation Pathway",
                        context: "Breakthrough thinking requires freedom",
                        alternatives: [
                            "Schedule regular brainstorming sessions with diverse people",
                            "Study unrelated fields for cross-pollination ideas",
                            "Use constraints to spark creative solutions",
                            "Create mind maps to explore unexpected connections"
                        ],
                        confidence: 78
                    },
                    {
                        title: "Artistic Development Plan",
                        context: "Cultivate your creative skills systematically",
                        alternatives: [
                            "Take online courses from masters in your field",
                            "Join a critique group for constructive feedback",
                            "Set specific skill-building goals with deadlines",
                            "Create a portfolio of experimental work"
                        ],
                        confidence: 82
                    },
                    {
                        title: "Creative Project Launch",
                        context: "Turn ideas into tangible creations",
                        alternatives: [
                            "Start with minimum viable product approach",
                            "Launch a beta version to gather user feedback",
                            "Document your creative process for future reference",
                            "Partner with complementary creatives for collaboration"
                        ],
                        confidence: 75
                    },
                    {
                        title: "Creative Block Solutions",
                        context: "Overcome mental barriers and find inspiration",
                        alternatives: [
                            "Change your environment or work location",
                            "Try creative exercises like morning pages",
                            "Consume diverse art and media for new perspectives",
                            "Take a complete break to reset your mind"
                        ],
                        confidence: 80
                    }
                ]
            },
            finance: {
                keywords: ['money', 'invest', 'save', 'budget', 'debt', 'loan', 'mortgage', 'retirement', 'crypto', 'stocks', 'spending'],
                suggestions: [
                    {
                        title: "Financial Security Strategy",
                        context: "Balance risk management with growth potential",
                        alternatives: [
                            "Build 6-month emergency fund in high-yield savings",
                            "Diversify across stocks, bonds, and real estate",
                            "Consult with a certified financial planner",
                            "Automate savings and investments for consistency"
                        ],
                        confidence: 88
                    },
                    {
                        title: "Investment Decision",
                        context: "Consider risk tolerance and time horizon",
                        alternatives: [
                            "Low-cost index funds for long-term growth",
                            "Real estate crowdfunding for diversification",
                            "Tax-advantaged retirement accounts (401k, IRA)",
                            "Fractional shares of blue-chip companies"
                        ],
                        confidence: 82
                    },
                    {
                        title: "Debt Management Plan",
                        context: "Strategic approach to eliminating debt",
                        alternatives: [
                            "Avalanche method: target highest interest debt first",
                            "Snowball method: pay off smallest debts for momentum",
                            "Debt consolidation through personal loan",
                            "Negotiate lower interest rates with creditors"
                        ],
                        confidence: 85
                    },
                    {
                        title: "Budget Optimization",
                        context: "Maximize savings without sacrificing quality of life",
                        alternatives: [
                            "50/30/20 rule: needs, wants, savings allocation",
                            "Zero-based budgeting for complete expense tracking",
                            "Envelope system for discretionary spending",
                            "Subscription audit and automated savings apps"
                        ],
                        confidence: 80
                    },
                    {
                        title: "Side Income Generation",
                        context: "Create additional revenue streams",
                        alternatives: [
                            "Freelance work using existing professional skills",
                            "Rental income through property or room sharing",
                            "Online course creation in your area of expertise",
                            "Dividend-paying stock portfolio for passive income"
                        ],
                        confidence: 75
                    }
                ]
            },
            education: {
                keywords: ['learn', 'study', 'course', 'degree', 'school', 'college', 'skill', 'training', 'certification', 'master', 'phd'],
                suggestions: [
                    {
                        title: "Learning Path Optimization",
                        context: "Maximize knowledge retention and application",
                        alternatives: [
                            "Apply concepts immediately through real projects",
                            "Find a mentor in your field of study",
                            "Use spaced repetition for long-term retention",
                            "Join study groups for collaborative learning"
                        ],
                        confidence: 85
                    },
                    {
                        title: "Skill Development Strategy",
                        context: "Focus on marketable and personally valuable skills",
                        alternatives: [
                            "Learn programming languages like Python or JavaScript",
                            "Develop public speaking and presentation skills",
                            "Master data analysis and visualization tools",
                            "Practice project management methodologies"
                        ],
                        confidence: 80
                    },
                    {
                        title: "Educational Investment Decision",
                        context: "Choose the right learning opportunity",
                        alternatives: [
                            "Compare ROI of degree vs. bootcamp vs. self-study",
                            "Research industry-specific certification requirements",
                            "Audit free online courses before committing",
                            "Network with alumni from prospective programs"
                        ],
                        confidence: 78
                    },
                    {
                        title: "Career Transition Learning",
                        context: "Acquire skills for new professional direction",
                        alternatives: [
                            "Identify transferable skills from current experience",
                            "Take industry-specific courses on platforms like Coursera",
                            "Attend industry conferences and workshops",
                            "Create portfolio projects demonstrating new skills"
                        ],
                        confidence: 82
                    },
                    {
                        title: "Continuous Learning Habit",
                        context: "Build sustainable lifelong learning practices",
                        alternatives: [
                            "Dedicate 30 minutes daily to reading industry publications",
                            "Subscribe to educational podcasts and audiobooks",
                            "Join professional associations with learning resources",
                            "Set quarterly learning goals with measurable outcomes"
                        ],
                        confidence: 75
                    }
                ]
            },
            health: {
                keywords: ['doctor', 'medicine', 'treatment', 'surgery', 'therapy', 'fitness', 'diet', 'mental health', 'exercise', 'workout'],
                suggestions: [
                    {
                        title: "Health Optimization Plan",
                        context: "Prioritize evidence-based approaches",
                        alternatives: [
                            "Schedule annual physical and dental checkups",
                            "Get second opinions for major medical decisions",
                            "Implement preventive screening schedule",
                            "Create personalized health tracking system"
                        ],
                        confidence: 92
                    },
                    {
                        title: "Fitness Routine Design",
                        context: "Build sustainable exercise habits",
                        alternatives: [
                            "Start with 30-minute walks 3 times per week",
                            "Join group fitness classes for motivation",
                            "Create home workout space with basic equipment",
                            "Try strength training 2x weekly plus cardio"
                        ],
                        confidence: 88
                    },
                    {
                        title: "Nutrition Enhancement",
                        context: "Optimize diet for energy and longevity",
                        alternatives: [
                            "Meal prep Sundays for healthy weekday meals",
                            "Increase vegetable intake to 5 servings daily",
                            "Replace processed snacks with nuts and fruits",
                            "Stay hydrated with 8+ glasses of water daily"
                        ],
                        confidence: 85
                    },
                    {
                        title: "Mental Wellness Strategy",
                        context: "Prioritize psychological health and stress management",
                        alternatives: [
                            "Start daily meditation practice (10 minutes)",
                            "Establish consistent sleep schedule (7-9 hours)",
                            "Journal thoughts and feelings regularly",
                            "Consider therapy or counseling for support"
                        ],
                        confidence: 90
                    },
                    {
                        title: "Preventive Health Measures",
                        context: "Proactive approach to long-term wellbeing",
                        alternatives: [
                            "Research family health history and risks",
                            "Schedule age-appropriate health screenings",
                            "Learn basic first aid and emergency preparedness",
                            "Create emergency contact and medical information system"
                        ],
                        confidence: 87
                    }
                ]
            },
            travel: {
                keywords: ['trip', 'vacation', 'flight', 'hotel', 'destination', 'adventure', 'explore', 'journey', 'holiday', 'getaway'],
                suggestions: [
                    {
                        title: "Travel Experience Design",
                        context: "Balance adventure with practical considerations",
                        alternatives: [
                            "Book boutique hotel in historic city center",
                            "Plan spontaneous road trip with flexible itinerary",
                            "Choose all-inclusive resort for stress-free relaxation",
                            "Stay in local Airbnb for authentic neighborhood experience"
                        ],
                        confidence: 80
                    },
                    {
                        title: "Budget Travel Strategy",
                        context: "Maximize experience while minimizing costs",
                        alternatives: [
                            "Travel during shoulder season for better prices",
                            "Use flight comparison apps and book Tuesday departures",
                            "Stay in hostels with private rooms for social atmosphere",
                            "Pack light to avoid baggage fees and travel flexibly"
                        ],
                        confidence: 85
                    },
                    {
                        title: "Adventure Travel Planning",
                        context: "Seek thrilling experiences safely",
                        alternatives: [
                            "Book guided hiking tour in national park",
                            "Try scuba diving certification in tropical location",
                            "Plan multi-day cycling trip through wine country",
                            "Register for wilderness survival skills course"
                        ],
                        confidence: 78
                    },
                    {
                        title: "Cultural Immersion Journey",
                        context: "Deep dive into local traditions and lifestyle",
                        alternatives: [
                            "Stay with local family through homestay program",
                            "Take cooking classes featuring regional cuisine",
                            "Learn basic language phrases before departure",
                            "Visit local markets and festivals like a resident"
                        ],
                        confidence: 82
                    },
                    {
                        title: "Wellness Retreat Selection",
                        context: "Rejuvenate mind and body through travel",
                        alternatives: [
                            "Book yoga and meditation retreat in peaceful setting",
                            "Choose spa resort with natural hot springs",
                            "Plan digital detox weekend in nature",
                            "Select wellness cruise with healthy dining options"
                        ],
                        confidence: 75
                    }
                ]
            }
        };

        const contextModifiers = {
            time: {
                high: "Time-sensitive decision - prioritize quick, actionable options",
                low: "Flexible timeline - explore thorough analysis and creative alternatives"
            },
            budget: {
                high: "Budget-conscious approach - focus on cost-effective solutions",
                low: "Investment mindset - consider long-term value over immediate cost"
            },
            energy: {
                high: "High energy - tackle challenging, high-reward options",
                low: "Conserve energy - choose simpler, less demanding paths"
            },
            social: {
                high: "Social impact priority - consider how decisions affect relationships",
                low: "Individual focus - prioritize personal needs and goals"
            },
            risk: {
                high: "Risk-averse - choose safe, proven options",
                low: "Risk-tolerant - explore innovative, high-potential alternatives"
            },
            growth: {
                high: "Growth-focused - prioritize learning and development opportunities",
                low: "Comfort-focused - choose familiar, reliable options"
            },
            health: {
                high: "Health priority - choose options that support physical and mental wellbeing",
                low: "Health flexible - can accommodate more demanding options"
            },
            environment: {
                high: "Eco-conscious - prioritize sustainable and environmentally friendly choices",
                low: "Environment flexible - consider other factors primarily"
            }
        };

        // Local storage management
        let decisionHistory = JSON.parse(localStorage.getItem('decisionHistory')) || [];
        let userStats = JSON.parse(localStorage.getItem('userStats')) || {
            totalDecisions: 0,
            avgConfidence: 0,
            mostCommonType: '-',
            currentStreak: 0,
            lastDecisionDate: null
        };

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'history') {
                loadHistory();
            } else if (tabName === 'stats') {
                updateStats();
                generateInsights();
            } else if (tabName === 'motivation') {
                loadMotivationContent();
            }
        }

        // Mood and energy sliders
        document.getElementById('mood-slider').addEventListener('input', function() {
            document.getElementById('mood-value').textContent = this.value;
        });

        document.getElementById('energy-slider').addEventListener('input', function() {
            document.getElementById('energy-value').textContent = this.value;
        });

        function getSelectedFactors() {
            const selected = [];
            document.querySelectorAll('.factor-card.selected').forEach(card => {
                selected.push(card.dataset.factor);
            });
            return selected;
        }

        function toggleFactor(card) {
            card.classList.toggle('selected');
            if (card.classList.contains('selected')) {
                card.classList.add('bounce-in');
                setTimeout(() => card.classList.remove('bounce-in'), 800);
            } else {
                card.classList.add('shake');
                setTimeout(() => card.classList.remove('shake'), 500);
            }
        }

        function analyzeDecision(decisionText) {
            const lowerText = decisionText.toLowerCase();
            
            for (const [category, data] of Object.entries(decisionPatterns)) {
                for (const keyword of data.keywords) {
                    if (lowerText.includes(keyword)) {
                        return category;
                    }
                }
            }
            
            return 'general';
        }

        async function generateRandomSuggestion(category, factors, priority, mood, energy) {
            const decisionText = document.getElementById('decision').value;
            
            // GEMINI AI INTEGRATION - FORCE AI RESPONSE
            try {
                console.log('ü§ñ Attempting Gemini AI call...');
                const geminiResponse = await callGeminiAPI(decisionText, category, factors, priority, mood, energy);
                if (geminiResponse) {
                    console.log('‚úÖ Gemini AI response successful:', geminiResponse);
                    return geminiResponse;
                } else {
                    console.log('‚ö†Ô∏è Gemini returned null response');
                }
            } catch (error) {
                console.error('‚ùå Gemini API failed:', error);
                
                // SHOW GEMINI API FAILURE NOTIFICATION
                showGeminiFailureNotification();
            }
            
            // SMART FALLBACK - INTELLIGENT LOCAL AI
            console.log('üîÑ Using intelligent local AI fallback...');
            
            // Generate intelligent local suggestion based on input
            return generateIntelligentLocalSuggestion(decisionText, category, factors, priority, mood, energy);
        }

        // INTELLIGENT LOCAL AI FALLBACK
        function generateIntelligentLocalSuggestion(decisionText, category, factors, priority, mood, energy) {
            console.log('üß† Generating intelligent local suggestion...');
            
            // Analyze the decision text for keywords
            const lowerText = decisionText.toLowerCase();
            let title = "Smart Recommendation";
            let context = "";
            let confidence = 75;
            
            // Education/Study related
            if (lowerText.includes('study') || lowerText.includes('test') || lowerText.includes('exam') || lowerText.includes('homework') || lowerText.includes('learn')) {
                title = "Academic Success Strategy";
                context = `Based on your input about "${decisionText}", here's a strategic approach to maximize your learning outcomes. `;
                
                if (mood <= 3) {
                    context += "Given your current low mood, consider breaking study sessions into smaller, manageable chunks with frequent breaks. ";
                    confidence += 5;
                } else if (mood >= 8) {
                    context += "With your positive energy, this is a great time to tackle challenging material and make significant progress. ";
                    confidence += 5;
                }
                
                if (energy <= 3) {
                    context += "Since you're low on energy, focus on review and consolidation rather than learning new complex topics. ";
                } else if (energy >= 8) {
                    context += "Your high energy level makes this perfect for intensive study sessions and problem-solving. ";
                }
                
                context += "Consider using active learning techniques like practice tests, teaching concepts to others, and creating study schedules. ";
                context += priority ? `Priority focus: ${priority}. ` : "";
                context += factors.length > 0 ? `Key factors: ${factors.join(', ')}.` : "";
                
                confidence = Math.min(95, Math.max(60, confidence));
            }
            
            // Career/Work related
            else if (lowerText.includes('job') || lowerText.includes('work') || lowerText.includes('career') || lowerText.includes('boss') || lowerText.includes('colleague')) {
                title = "Professional Development Approach";
                context = `Analyzing your professional situation regarding "${decisionText}". `;
                
                if (mood <= 4) {
                    context += "Given your current emotional state, consider decisions that prioritize your wellbeing and work-life balance. ";
                } else {
                    context += "With your current mindset, this could be a good time for strategic career moves or skill development. ";
                }
                
                context += "Evaluate options based on long-term growth potential, immediate impact, and alignment with your values. ";
                context += priority ? `Priority focus: ${priority}. ` : "";
                context += factors.length > 0 ? `Key factors: ${factors.join(', ')}.` : "";
                
                confidence = 80;
            }
            
            // Personal/Life decisions
            else if (lowerText.includes('relationship') || lowerText.includes('friend') || lowerText.includes('family') || lowerText.includes('personal')) {
                title = "Life Decision Framework";
                context = `Considering your personal situation with "${decisionText}". `;
                
                context += "This decision impacts your personal wellbeing and relationships. Take time to reflect on your values and long-term happiness. ";
                context += mood <= 5 ? "Given your current mood, consider decisions that support emotional stability and self-care. " : "With your positive outlook, this could be a great time for meaningful personal growth. ";
                context += priority ? `Priority focus: ${priority}. ` : "";
                context += factors.length > 0 ? `Key factors: ${factors.join(', ')}.` : "";
                
                confidence = 78;
            }
            
            // Health/Wellness
            else if (lowerText.includes('health') || lowerText.includes('exercise') || lowerText.includes('diet') || lowerText.includes('sleep') || lowerText.includes('mental')) {
                title = "Wellness Optimization Plan";
                context = `Addressing your health consideration: "${decisionText}". `;
                
                context += "Health decisions require careful consideration of both physical and mental wellbeing. ";
                context += energy <= 4 ? "With your current energy levels, focus on gentle, sustainable changes rather than drastic overhauls. " : "Your good energy makes this an ideal time to establish healthy routines and habits. ";
                context += priority ? `Priority focus: ${priority}. ` : "";
                context += factors.length > 0 ? `Key factors: ${factors.join(', ')}.` : "";
                
                confidence = 82;
            }
            
            // General/Fallback
            else {
                title = "Strategic Decision Framework";
                context = `Analyzing your decision about "${decisionText}". `;
                
                context += "This is an important decision that deserves careful consideration. ";
                context += `Your current mood (${mood}/10) and energy (${energy}/10) levels suggest `;
                
                if (mood <= 4 && energy <= 4) {
                    context += "you should prioritize self-care and avoid major changes right now. ";
                    confidence -= 10;
                } else if (mood >= 7 && energy >= 7) {
                    context += "this is an excellent time for making bold, positive changes. ";
                    confidence += 10;
                } else {
                    context += "you should take a balanced, measured approach. ";
                }
                
                context += priority ? `Priority focus: ${priority}. ` : "";
                context += factors.length > 0 ? `Key factors: ${factors.join(', ')}.` : "";
                
                confidence = Math.min(90, Math.max(65, confidence));
            }
            
            // Add mood and energy specific advice
            if (mood <= 3) {
                context += " Consider seeking support from friends, family, or professionals if you're struggling.";
            } else if (mood >= 8) {
                context += " Your positive mindset is an asset - use it to tackle this decision confidently.";
            }
            
            if (energy <= 3) {
                context += " Focus on simple, actionable steps that won't overwhelm you.";
            } else if (energy >= 8) {
                context += " You have the energy to pursue more comprehensive solutions.";
            }
            
            return {
                title: title,
                context: context,
                confidence: confidence,
                source: 'Local AI'
            };
        }

        // GEMINI API FAILURE NOTIFICATION
        function showGeminiFailureNotification() {
            // Create notification modal
            const notificationHTML = `
                <div id="gemini-failure-notification" style="
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #ff6b6b, #ff8e53);
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    z-index: 10000;
                    max-width: 400px;
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    border-left: 4px solid #ff4757;
                ">
                    <h3 style="margin: 0 0 10px 0; color: #ffeaa7;">‚ö†Ô∏è Gemini API Unavailable</h3>
                    <p style="margin: 0 0 15px 0; line-height: 1.4;">
                        <strong>Local Development Environment Detected</strong><br>
                        The Gemini AI service is unavailable when running on localhost/ports due to CORS restrictions.
                    </p>
                    <p style="margin: 0 0 15px 0; line-height: 1.4;">
                        <strong>üîß Solution:</strong> Deploy to a real website or use our intelligent local AI system.
                    </p>
                    <div style="margin: 15px 0; text-align: center;">
                        <button onclick="window.open('https://aidandeneve-alt.github.io/Info-center-help-center/', '_blank')" style="
                            background: #007bff;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 5px;
                            cursor: pointer;
                            font-size: 14px;
                            margin-right: 10px;
                        ">üìû Get Support</button>
                        <button onclick="closeGeminiNotification()" style="
                            background: #6c757d;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 5px;
                            cursor: pointer;
                            font-size: 14px;
                        ">‚úÖ Continue with Local AI</button>
                    </div>
                    <p style="margin: 15px 0 0 0; font-size: 12px; opacity: 0.8;">
                        üí° <strong>Note:</strong> Our local AI system provides intelligent, context-aware suggestions even without external APIs.
                    </p>
                </div>
            `;
            
            // Add notification to page
            document.body.insertAdjacentHTML('beforeend', notificationHTML);
            
            // Auto-remove after 15 seconds
            setTimeout(() => {
                const notification = document.getElementById('gemini-failure-notification');
                if (notification) {
                    notification.remove();
                }
            }, 15000);
        }

        function closeGeminiNotification() {
            const notification = document.getElementById('gemini-failure-notification');
            if (notification) {
                notification.remove();
            }
        }

        // GEMINI AI API FUNCTION (PURE JAVASCRIPT)
        async function callGeminiAPI(decisionText, category, factors, priority, mood, energy) {
            try {
                console.log('ü§ñ Calling Gemini AI directly...');
                console.log('üìù Input:', decisionText);
                console.log('üìÇ Category:', category);
                
                // Built-in Gemini API key (you can change this)
                const GEMINI_API_KEY = "AIzaSyBIdG2HNjRRRA8x_9JvWMDSnVLW3jM__Ic";
                console.log('üîë API Key length:', GEMINI_API_KEY.length);
                
                // Test if API key is valid format
                if (!GEMINI_API_KEY || GEMINI_API_KEY.length < 30) {
                    throw new Error('Invalid API key format');
                }
                
                const prompt = `You are an intelligent decision-making assistant. Analyze the user's situation and provide thoughtful, personalized recommendations.

USER INPUT: "${decisionText}"
CATEGORY: ${category}
SELECTED FACTORS: ${factors.join(', ') || 'None'}
PRIORITY: ${priority || 'None'}
MOOD LEVEL: ${mood}/10 (1=very low, 10=very high)
ENERGY LEVEL: ${energy}/10 (1=very low, 10=very high)

Please provide:
1. A clear, actionable title for your recommendation
2. A detailed explanation of why this approach makes sense for their situation
3. A confidence score (60-95%) based on how well this fits their context

Format your response as JSON:
{
    "title": "Clear recommendation title",
    "context": "Detailed explanation of why this makes sense for their specific situation",
    "confidence": 85
}

Be specific, practical, and empathetic. Consider their mood and energy levels in your recommendations.`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    console.error('‚ùå API Response Status:', response.status);
                    console.error('‚ùå API Response Text:', await response.text());
                    throw new Error(`Gemini API error: ${response.status}`);
                }

                const data = await response.json();
                console.log('üìä Full API Response:', data);
                
                const text = data.candidates[0]?.content?.parts[0]?.text;
                
                if (!text) {
                    console.error('‚ùå No text in response:', data);
                    throw new Error('No response from Gemini');
                }

                console.log('üìù Gemini raw response:', text);

                // Parse JSON response
                try {
                    // Clean up the response text to extract JSON
                    let jsonText = text;
                    if (text.includes('```json')) {
                        const start = text.indexOf('```json') + 7;
                        const end = text.indexOf('```', start);
                        jsonText = text.substring(start, end).trim();
                    } else if (text.includes('{') && text.includes('}')) {
                        const start = text.indexOf('{');
                        const end = text.lastIndexOf('}') + 1;
                        jsonText = text.substring(start, end);
                    }
                    
                    const aiSuggestion = JSON.parse(jsonText);
                    console.log('‚úÖ Gemini response parsed:', aiSuggestion);
                    
                    return {
                        title: aiSuggestion.title,
                        context: aiSuggestion.context,
                        confidence: aiSuggestion.confidence,
                        source: 'Gemini AI'
                    };
                } catch (parseError) {
                    console.error('‚ùå Failed to parse Gemini response:', parseError);
                    console.log('Raw text that failed to parse:', text);
                    return null;
                }
                
            } catch (error) {
                console.error('‚ùå Gemini API call failed:', error);
                return null;
            }
        }

        function generateDecision() {
            const decisionText = document.getElementById('decision').value;
            const priority = document.getElementById('priority').value;
            const factors = getSelectedFactors();
            const mood = parseInt(document.getElementById('mood-slider').value);
            const energy = parseInt(document.getElementById('energy-slider').value);
            
            if (!decisionText.trim()) {
                alert('Please describe your decision first!');
                return;
            }
            
            // CRISIS DETECTION SYSTEM
            console.log('üîç ANALYZING TEXT:', decisionText);
            console.log('üîç MOOD LEVEL:', mood);
            console.log('üîç LOWERCASE VERSION:', decisionText.toLowerCase());
            
            const crisisDetected = detectCrisis(decisionText, mood);
            console.log('üö® Crisis detection result:', crisisDetected);
            if (crisisDetected) {
                console.log('üÜò Crisis detected in assistant:', decisionText, 'Type:', localStorage.getItem('lastCrisisType'));
                showCrisisSupport();
                return;
            } else {
                console.log('‚úÖ No crisis detected, proceeding normally');
            }
            
            // Show loading spinner
            document.getElementById('loading').style.display = 'block';
            
            // ASYNC AI PROCESSING
            (async () => {
                try {
                    const category = analyzeDecision(decisionText);
                    const suggestion = await generateRandomSuggestion(category, factors, priority, mood, energy);
                    
                    displayResults(suggestion, decisionText, factors, priority, mood, energy);
                    saveToHistory(decisionText, suggestion, category, factors, priority, mood, energy);
                    
                    document.getElementById('loading').style.display = 'none';
                } catch (error) {
                    console.error('Error generating suggestion:', error);
                    document.getElementById('loading').style.display = 'none';
                    alert('Error generating suggestion. Please try again.');
                }
            })();
        }

        function displayResults(suggestion, originalDecision, factors, priority, mood, energy) {
            const resultsDiv = document.getElementById('results');
            const currentTime = new Date().toLocaleString();
            
            const moodEmoji = mood <= 3 ? 'üòî' : mood <= 7 ? 'üòê' : 'üòä';
            const energyEmoji = energy <= 3 ? 'üò¥' : energy <= 7 ? 'üôÇ' : '‚ö°';
            
            resultsDiv.innerHTML = `
                <div class="result-card glow-effect bounce-in">
                    <div class="time-context">
                        <span class="pulse"></span>
                        <span>Context analyzed at ${currentTime}</span>
                    </div>
                    
                    <div class="decision-title">
                        <div class="decision-icon floating">üß†</div>
                        <span class="holographic">${suggestion.title}</span>
                    </div>
                    
                    <div class="context-analysis glass-morphism">
                        <strong class="neon-text">AI Analysis:</strong><br>
                        ${suggestion.context}
                        <br><br>
                        <strong>Original Decision:</strong> "${originalDecision}"
                        ${priority ? `<br><strong>Priority:</strong> ${priority}` : ''}
                        ${factors.length > 0 ? `<br><strong>Factors:</strong> ${factors.join(', ')}` : ''}
                        <br><strong>Mood:</strong> ${mood}/10 ${moodEmoji} | <strong>Energy:</strong> ${energy}/10 ${energyEmoji}
                    </div>
                    
                    <div class="confidence-meter">
                        <div class="confidence-fill rainbow-border" style="width: ${suggestion.confidence}%"></div>
                    </div>
                    <small class="holographic">Confidence Level: ${suggestion.confidence}%</small>
                </div>
            `;
            
            // Store current suggestion globally for alternative selection
            window.currentSuggestion = suggestion;
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        
        function saveToHistory(decisionText, suggestion, category, factors, priority, mood, energy) {
            const historyItem = {
                id: Date.now(),
                date: new Date().toISOString(),
                decision: decisionText,
                suggestion: suggestion,
                category: category,
                factors: factors,
                priority: priority,
                mood: mood,
                energy: energy,
                confidence: suggestion.confidence
            };
            
            decisionHistory.unshift(historyItem);
            if (decisionHistory.length > 50) decisionHistory.pop(); // Keep only last 50
            
            localStorage.setItem('decisionHistory', JSON.stringify(decisionHistory));
            
            // Update stats
            updateStatistics();
        }

        function loadHistory() {
            const historyList = document.getElementById('history-list');
            
            if (decisionHistory.length === 0) {
                historyList.innerHTML = '<p>No decision history yet. Start making decisions to see your history here!</p>';
                return;
            }
            
            historyList.innerHTML = decisionHistory.map(item => `
                <div class="history-item" onclick="viewHistoryItem(${item.id})">
                    <strong>${item.suggestion.title}</strong>
                    <br><small>${new Date(item.date).toLocaleDateString()} - Confidence: ${item.confidence}%</small>
                    <br><em>${item.decision.substring(0, 100)}${item.decision.length > 100 ? '...' : ''}</em>
                </div>
            `).join('');
        }

        function viewHistoryItem(id) {
            const item = decisionHistory.find(h => h.id === id);
            if (item) {
                displayResults(item.suggestion, item.decision, item.factors, item.priority, item.mood, item.energy);
                switchTab('assistant');
            }
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all decision history?')) {
                decisionHistory = [];
                localStorage.setItem('decisionHistory', JSON.stringify(decisionHistory));
                loadHistory();
            }
        }

        function compareDecisions() {
            const decision1 = document.getElementById('compare1').value;
            const decision2 = document.getElementById('compare2').value;
            const resultsDiv = document.getElementById('comparison-results');
            
            if (!decision1.trim() || !decision2.trim()) {
                alert('Please enter both decisions to compare');
                return;
            }
            
            const category1 = analyzeDecision(decision1);
            const category2 = analyzeDecision(decision2);
            
            const factors1 = [];
            const factors2 = [];
            
            const suggestion1 = generateRandomSuggestion(category1, factors1, '', 5, 5);
            const suggestion2 = generateRandomSuggestion(category2, factors2, '', 5, 5);
            
            resultsDiv.innerHTML = `
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <h3>Decision 1 Analysis</h3>
                        <p><strong>Category:</strong> ${category1}</p>
                        <p><strong>Suggestion:</strong> ${suggestion1.title}</p>
                        <p><strong>Confidence:</strong> ${suggestion1.confidence}%</p>
                    </div>
                    <div class="comparison-item">
                        <h3>Decision 2 Analysis</h3>
                        <p><strong>Category:</strong> ${category2}</p>
                        <p><strong>Suggestion:</strong> ${suggestion2.title}</p>
                        <p><strong>Confidence:</strong> ${suggestion2.confidence}%</p>
                    </div>
                </div>
            `;
        }

        function updateStatistics() {
            const stats = userStats;
            
            document.getElementById('total-decisions').textContent = decisionHistory.length;
            
            if (decisionHistory.length > 0) {
                const avgConf = Math.round(decisionHistory.reduce((sum, item) => sum + item.confidence, 0) / decisionHistory.length);
                document.getElementById('avg-confidence').textContent = avgConf + '%';
                
                const categories = decisionHistory.map(item => item.category);
                const mostCommon = categories.sort((a,b) => 
                    categories.filter(v => v===a).length - categories.filter(v => v===b).length
                ).pop();
                document.getElementById('most-common').textContent = mostCommon;
            }
            
            // Calculate streak
            const today = new Date().toDateString();
            const lastDate = stats.lastDecisionDate ? new Date(stats.lastDecisionDate).toDateString() : null;
            
            if (lastDate === today) {
                // Already counted today
            } else if (lastDate === new Date(Date.now() - 86400000).toDateString()) {
                stats.currentStreak++;
            } else {
                stats.currentStreak = 1;
            }
            
            stats.lastDecisionDate = new Date().toISOString();
            document.getElementById('current-streak').textContent = stats.currentStreak;
            
            localStorage.setItem('userStats', JSON.stringify(stats));
        }

        function updateStats() {
            updateStatistics();
        }

        // Initialize
        document.querySelectorAll('.factor-card').forEach(card => {
            card.addEventListener('click', () => toggleFactor(card));
        });

        document.getElementById('decision').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                generateDecision();
            }
        });

        // Priority sliders
        document.getElementById('urgency-slider').addEventListener('input', function() {
            document.getElementById('urgency-value').textContent = this.value;
        });

        document.getElementById('importance-slider').addEventListener('input', function() {
            document.getElementById('importance-value').textContent = this.value;
        });

        document.getElementById('effort-slider').addEventListener('input', function() {
            document.getElementById('effort-value').textContent = this.value;
        });

        // NEW FUN FEATURES
        
        // Decision Matrix Tool
        function createMatrix() {
            const option1 = document.getElementById('option1').value;
            const option2 = document.getElementById('option2').value;
            const option3 = document.getElementById('option3').value;
            const resultDiv = document.getElementById('matrix-result');
            
            if (!option1 || !option2) {
                resultDiv.innerHTML = '<p style="color: red;">Please enter at least 2 options</p>';
                return;
            }
            
            const criteria = ['Cost', 'Time', 'Impact', 'Risk', 'Enjoyment'];
            let matrixHTML = '<table style="width: 100%; border-collapse: collapse; margin-top: 15px;"><tr><th>Option</th>';
            
            criteria.forEach(criterion => {
                matrixHTML += `<th>${criterion}</th><th>Score</th>`;
            });
            matrixHTML += '</tr>';
            
            const options = [option1, option2, option3].filter(opt => opt);
            
            options.forEach(option => {
                let totalScore = 0;
                matrixHTML += `<tr><td><strong>${option}</strong></td>`;
                
                criteria.forEach(() => {
                    const score = Math.floor(Math.random() * 5) + 1;
                    totalScore += score;
                    const stars = '‚≠ê'.repeat(score);
                    matrixHTML += `<td style="text-align: center;">${stars}</td>`;
                });
                
                matrixHTML += `<td style="text-align: center; font-weight: bold;">${totalScore}/25</td></tr>`;
            });
            
            matrixHTML += '</table>';
            resultDiv.innerHTML = matrixHTML;
        }

        // Time Tracker
        let timerInterval;
        let startTime;
        let timeEntries = JSON.parse(localStorage.getItem('timeEntries')) || [];

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                const duration = Math.floor((Date.now() - startTime) / 1000);
                const entry = {
                    duration: duration,
                    date: new Date().toISOString(),
                    description: 'Decision making session'
                };
                timeEntries.push(entry);
                localStorage.setItem('timeEntries', JSON.stringify(timeEntries));
                updateTimeLog();
            }
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;
            
            document.getElementById('timer-display').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateTimeLog() {
            const logDiv = document.getElementById('time-log');
            const recentEntries = timeEntries.slice(-5).reverse();
            
            logDiv.innerHTML = '<h4>Recent Sessions:</h4>' + 
                recentEntries.map(entry => {
                    const duration = formatDuration(entry.duration);
                    return `<div>${duration} - ${new Date(entry.date).toLocaleString()}</div>`;
                }).join('');
        }

        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) return `${hours}h ${minutes}m`;
            if (minutes > 0) return `${minutes}m ${secs}s`;
            return `${secs}s`;
        }

        // Random Choice Tool
        function randomChoice() {
            const options = document.getElementById('random-options').value.split('\n').filter(opt => opt.trim());
            const resultDiv = document.getElementById('random-result');
            
            if (options.length === 0) {
                resultDiv.innerHTML = '<p style="color: red;">Please enter at least one option</p>';
                return;
            }
            
            const chosen = options[Math.floor(Math.random() * options.length)];
            resultDiv.innerHTML = `<div class="glow-effect" style="padding: 15px; border-radius: 10px; text-align: center; font-size: 18px; font-weight: bold;">
                üé≤ The universe has chosen:<br><br>
                <span style="color: #667eea;">${chosen}</span>
            </div>`;
        }

        // Priority Calculator
        function calculatePriority() {
            const decision = document.getElementById('priority-decision').value;
            const urgency = parseInt(document.getElementById('urgency-slider').value);
            const importance = parseInt(document.getElementById('importance-slider').value);
            const effort = parseInt(document.getElementById('effort-slider').value);
            const resultDiv = document.getElementById('priority-result');
            
            if (!decision) {
                resultDiv.innerHTML = '<p style="color: red;">Please enter a decision</p>';
                return;
            }
            
            const score = (urgency * 2) + (importance * 3) - (effort * 1);
            let priority = 'Low';
            let color = '#28a745';
            
            if (score > 30) {
                priority = 'High';
                color = '#dc3545';
            } else if (score > 15) {
                priority = 'Medium';
                color = '#ffc107';
            }
            
            resultDiv.innerHTML = `
                <div style="padding: 15px; border-radius: 10px; background: ${color}20; border: 2px solid ${color};">
                    <h4>Priority Score: ${score}</h4>
                    <p><strong>Priority Level:</strong> <span style="color: ${color}; font-weight: bold;">${priority}</span></p>
                    <p><strong>Breakdown:</strong> Urgency (${urgency}/10) √ó 2 + Importance (${importance}/10) √ó 3 - Effort (${effort}/10) √ó 1</p>
                </div>
            `;
        }

        // Motivation Content
        const quotes = [
            "The only way to do great work is to love what you do. - Steve Jobs",
            "Innovation distinguishes between a leader and a follower. - Steve Jobs",
            "Life is 10% what happens to you and 90% how you react to it. - Charles R. Swindoll",
            "The future belongs to those who believe in the beauty of their dreams. - Eleanor Roosevelt",
            "It does not matter how slowly you go as long as you do not stop. - Confucius",
            "Everything you've ever wanted is on the other side of fear. - George Addair",
            "Success is not final, failure is not fatal: it is the courage to continue that counts. - Winston Churchill",
            "Believe you can and you're halfway there. - Theodore Roosevelt",
            "The only impossible journey is the one you never begin. - Tony Robbins",
            "In the middle of difficulty lies opportunity. - Albert Einstein"
        ];

        const challenges = [
            "Take a 10-minute walk and notice 3 things you've never seen before",
            "Write down 3 things you're grateful for right now",
            "Compliment a stranger or colleague sincerely",
            "Try something new for lunch today",
            "Learn one new word in a foreign language",
            "Organize one small area of your living space",
            "Call or text someone you haven't spoken to in a while",
            "Spend 5 minutes doing deep breathing exercises",
            "Read one chapter of a book or article",
            "Do 10 push-ups or stretches right now"
        ];

        function newQuote() {
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('daily-quote').innerHTML = `"${quote}"`;
        }

        function loadMotivationContent() {
            newQuote();
            loadDailyChallenge();
            loadAchievements();
            loadMoodHistory();
        }

        function loadDailyChallenge() {
            const today = new Date().toDateString();
            const challengeIndex = new Date(today).getTime() % challenges.length;
            document.getElementById('daily-challenge').textContent = challenges[challengeIndex];
        }

        function completeChallenge() {
            const achievements = JSON.parse(localStorage.getItem('achievements')) || [];
            const today = new Date().toDateString();
            
            if (!achievements.includes(today)) {
                achievements.push(today);
                localStorage.setItem('achievements', JSON.stringify(achievements));
                loadAchievements();
                alert('üéâ Challenge completed! Achievement unlocked!');
            } else {
                alert('You\'ve already completed today\'s challenge!');
            }
        }

        function loadAchievements() {
            const achievements = JSON.parse(localStorage.getItem('achievements')) || [];
            const achievementsDiv = document.getElementById('achievements-list');
            
            if (achievements.length === 0) {
                achievementsDiv.innerHTML = '<p>No achievements yet. Complete daily challenges to earn badges!</p>';
                return;
            }
            
            achievementsDiv.innerHTML = achievements.map(date => 
                `<div class="achievement-badge">‚úÖ ${new Date(date).toLocaleDateString()}</div>`
            ).join('');
        }

        function saveMoodEntry() {
            const entry = document.getElementById('mood-entry').value;
            if (!entry.trim()) {
                alert('Please write something about your mood first!');
                return;
            }
            
            // Check for crisis indicators in mood entries too
            const moodCrisisDetected = detectCrisis(entry, 5);
            if (moodCrisisDetected) {
                console.log('Crisis detected in mood journal:', entry, 'Type:', localStorage.getItem('lastCrisisType'));
                showCrisisSupport();
                return;
            }
            
            const moodEntries = JSON.parse(localStorage.getItem('moodEntries')) || [];
            moodEntries.unshift({
                text: entry,
                date: new Date().toISOString()
            });
            
            localStorage.setItem('moodEntries', JSON.stringify(moodEntries));
            document.getElementById('mood-entry').value = '';
            loadMoodHistory();
        }

        function loadMoodHistory() {
            const moodEntries = JSON.parse(localStorage.getItem('moodEntries')) || [];
            const historyDiv = document.getElementById('mood-history');
            
            if (moodEntries.length === 0) {
                historyDiv.innerHTML = '<p>No mood entries yet. Start tracking your daily feelings!</p>';
                return;
            }
            
            historyDiv.innerHTML = moodEntries.slice(0, 10).map(entry => `
                <div class="mood-entry-item">
                    <div class="mood-date">${new Date(entry.date).toLocaleString()}</div>
                    <div>${entry.text}</div>
                </div>
            `).join('');
        }

        // Decision Insights
        function generateInsights() {
            const insightsDiv = document.getElementById('insights-container');
            
            if (decisionHistory.length === 0) {
                insightsDiv.innerHTML = '<p>Start making decisions to see insights about your patterns!</p>';
                return;
            }
            
            const insights = [];
            
            // Most common time of day
            const hours = decisionHistory.map(item => new Date(item.date).getHours());
            const avgHour = Math.round(hours.reduce((a, b) => a + b, 0) / hours.length);
            insights.push({
                title: '‚è∞ Peak Decision Time',
                content: `You make most decisions around ${avgHour}:00. Consider scheduling important choices during your peak hours.`
            });
            
            // Average mood during decisions
            const avgMood = Math.round(decisionHistory.reduce((sum, item) => sum + item.mood, 0) / decisionHistory.length);
            insights.push({
                title: 'üòä Decision Mood Pattern',
                content: `Your average mood during decisions is ${avgMood}/10. ${avgMood >= 7 ? 'You make decisions when feeling good!' : 'Consider waiting for better moods for important choices.'}`
            });
            
            // Most used factors
            const factorCounts = {};
            decisionHistory.forEach(item => {
                item.factors.forEach(factor => {
                    factorCounts[factor] = (factorCounts[factor] || 0) + 1;
                });
            });
            
            const topFactor = Object.keys(factorCounts).reduce((a, b) => 
                factorCounts[a] > factorCounts[b] ? a : b, Object.keys(factorCounts)[0]);
            
            if (topFactor) {
                insights.push({
                    title: 'üéØ Primary Consideration',
                    content: `You most often consider "${topFactor}" when making decisions. This shows what matters most to you.`
                });
            }
            
            // Confidence trend
            const recentDecisions = decisionHistory.slice(0, 5);
            const olderDecisions = decisionHistory.slice(5, 10);
            
            if (recentDecisions.length >= 3 && olderDecisions.length >= 3) {
                const recentAvg = recentDecisions.reduce((sum, item) => sum + item.confidence, 0) / recentDecisions.length;
                const olderAvg = olderDecisions.reduce((sum, item) => sum + item.confidence, 0) / olderDecisions.length;
                
                if (recentAvg > olderAvg) {
                    insights.push({
                        title: 'üìà Growing Confidence',
                        content: 'Your decision confidence has been improving lately! Trust your instincts more.'
                    });
                }
            }
            
            insightsDiv.innerHTML = insights.map(insight => `
                <div class="insight-card bounce-in">
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-content">${insight.content}</div>
                </div>
            `).join('');
        }

        // ENHANCED CRISIS DETECTION AND SUPPORT SYSTEM
        function detectCrisis(decisionText, mood) {
            const suicideKeywords = [
                'suicide', 'kill myself', 'end my life', 'want to die', 'don\'t want to live',
                'better off dead', 'no point living', 'hate my life', 'can\'t go on',
                'want to disappear', 'end it all', 'take my own life', 'harm myself',
                'self harm', 'cut myself', 'hurt myself', 'no reason to live',
                'life is not worth living', 'wish I was dead', 'should just die',
                'want to commit suicide', 'thinking about suicide', 'suicidal thoughts'
            ];
            
            const severeDepressionKeywords = [
                'hopeless', 'helpless', 'worthless', 'burden', 'trap', 'stuck',
                'can\'t take it anymore', 'giving up', 'no way out', 'end my suffering',
                'too much pain', 'can\'t handle this', 'overwhelmed', 'broken',
                'empty inside', 'numb', 'dead inside', 'lost', 'alone forever'
            ];
            
            // DOMESTIC VIOLENCE DETECTION
            const domesticViolenceKeywords = [
                'abuse', 'abusive', 'hit me', 'hitting me', 'beating me', 'beat me',
                'violent', 'violence', 'threatening me', 'threats', 'scared of partner',
                'afraid to go home', 'unsafe at home', 'controlling', 'isolated',
                'financial abuse', 'emotional abuse', 'verbal abuse', 'physical abuse',
                'sexual abuse', 'coercive control', 'stalking', 'harassment',
                'forced', 'manipulated', 'gaslighting', 'trapped', 'no escape',
                'dangerous relationship', 'toxic relationship', 'abusive partner',
                'husband hits me', 'wife hits me', 'boyfriend abusive', 'girlfriend abusive',
                'family violence', 'child abuse', 'elder abuse'
            ];
            
            // CRIME VICTIM DETECTION
            const crimeVictimKeywords = [
                'robbed', 'mugged', 'assaulted', 'attacked', 'stolen from', 'burglary',
                'theft', 'violent crime', 'crime victim', 'witness to crime', 'threatened',
                'blackmail', 'extortion', 'kidnapped', 'held hostage', 'home invasion',
                'carjacked', 'pickpocketed', 'scammed', 'fraud', 'identity theft',
                'cybercrime', 'online harassment', 'cyberbullying', 'revenge porn',
                'hate crime', 'discrimination', 'harassment at work', 'workplace bullying',
                'stalked', 'being followed', 'someone watching me', 'break in', 'home invasion',
                'gun violence', 'shooting', 'knife attack', 'violent attack', 'physical assault',
                'sexual harassment', 'unwanted touching', 'groped', 'molested', 'inappropriate touching',
                'human trafficking', 'sex trafficking', 'forced labor', 'exploitation', 'grooming',
                'armed robbery', 'car theft', 'purse snatching', 'shoplifting', 'vandalism',
                'hate speech', 'racial harassment', 'homophobic harassment', 'transphobic abuse',
                'religious persecution', 'bullying', 'intimidation', 'threatening messages'
            ];
            
            // SUBSTANCE ABUSE & ADDICTION DETECTION
            const substanceAbuseKeywords = [
                'addiction', 'addicted', 'overdose', 'drug overdose', 'alcohol poisoning',
                'can\'t stop drinking', 'drinking problem', 'alcoholic', 'drug addict',
                'heroin', 'cocaine', 'meth', 'opioids', 'painkiller addiction',
                'withdrawal', 'detox', 'rehab needed', 'can\'t quit', 'relapse',
                'substance abuse', 'drug abuse', 'alcohol abuse', 'prescription drug abuse',
                'marijuana addiction', 'weed addiction', 'pot addiction', 'cannabis abuse',
                'lsd', 'acid', 'ecstasy', 'mdma', 'hallucinogens', 'psychedelics',
                'xanax', 'valium', 'benzos', 'benzodiazepines', 'prescription abuse',
                'fentanyl', 'oxycontin', 'percocet', 'vicodin', 'painkiller abuse',
                'crack cocaine', 'freebasing', 'shooting up', 'injecting drugs', 'needle use',
                'binge drinking', 'alcoholic blackout', 'drunk driving', 'dui', 'dwi',
                'meth addiction', 'crank', 'ice', 'speed', 'amphetamine abuse',
                'barbiturates', 'sleeping pills', 'tranquilizers', 'sedative abuse',
                'huffing', 'inhalant abuse', 'glue sniffing', 'aerosol abuse', 'solvent abuse'
            ];
            
            // EATING DISORDERS DETECTION
            const eatingDisorderKeywords = [
                'anorexia', 'bulimia', 'binge eating', 'eating disorder', 'starving myself',
                'making myself throw up', 'purging', 'laxatives', 'diet pills',
                'obsessed with weight', 'body dysmorphia', 'can\'t eat', 'afraid of food',
                'counting calories', 'excessive exercise', 'underweight', 'malnourished',
                'orthorexia', 'pica', 'rumination disorder', 'avoidant food intake',
                'night eating syndrome', 'compulsive eating', 'food addiction', 'emotional eating',
                'restrictive eating', 'food rules', 'safe foods', 'fear foods', 'forbidden foods',
                'body checking', 'mirror checking', 'weighing myself', 'measuring body',
                'hiding food', 'secret eating', 'food hoarding', 'throwing away food',
                'fasting', 'crash dieting', 'yo-yo dieting', 'extreme dieting', 'crash diets',
                'vomiting after eating', 'forced vomiting', 'self induced vomiting', 'making myself sick',
                'diuretic abuse', 'laxative abuse', 'enema abuse', 'water pills', 'colon cleansing',
                'body image issues', 'fat phobia', 'fear of gaining weight', 'weight obsession',
                'muscle dysmorphia', 'bigorexia', 'exercise addiction', 'compulsive exercise'
            ];
            
            // SELF-HARM DETECTION
            const selfHarmKeywords = [
                'cut myself', 'cutting', 'self injury', 'self harm', 'burn myself',
                'hitting myself', 'hurting myself', 'pain to feel something', 'self punishment',
                'self mutilation', 'self injury', 'self destructive', 'self sabotage',
                'self cutting', 'self burning', 'self punching', 'self hitting', 'self biting',
                'carving', 'scratching', 'pinching myself', 'pulling hair', 'head banging',
                'interfering with wound healing', 'picking scabs', 'skin picking', 'dermatillomania',
                'self inflicted wounds', 'self inflicted injuries', 'self inflicted pain',
                'emotional pain release', 'coping mechanism', 'stress relief', 'emotional regulation',
                'self punishment', 'self hate', 'self loathing', 'deserving pain', 'punishing myself',
                'blood letting', 'drawing blood', 'seeing blood', 'watching myself bleed',
                'hiding cuts', 'hiding scars', 'wearing long sleeves', 'covering injuries',
                'sharp objects', 'razor blades', 'knives', 'broken glass', 'self harm tools',
                'impulse to hurt myself', 'urge to cut', 'need to cut', 'want to cut'
            ];
            
            // TRAUMA & PTSD DETECTION
            const traumaKeywords = [
                'trauma', 'ptsd', 'flashbacks', 'nightmares', 'panic attacks',
                'anxiety attacks', 'hypervigilance', 'triggered', 're-experiencing',
                'sexual assault', 'rape', 'sexual violence', 'assault', 'violence',
                'war trauma', 'combat trauma', 'accident trauma', 'medical trauma',
                'childhood trauma', 'child abuse', 'neglect', 'emotional neglect', 'physical neglect',
                'complex ptsd', 'c-ptsd', 'developmental trauma', 'attachment trauma', 'relational trauma',
                'dissociation', 'dissociative episodes', 'feeling detached', 'out of body experience',
                'intrusive thoughts', 'intrusive memories', 'unwanted memories', 'memory gaps',
                'startle response', 'jumpiness', 'exaggerated startle', 'always on guard',
                'avoidance', 'avoiding reminders', 'emotional numbing', 'feeling numb',
                'survivor guilt', 'guilt about surviving', 'shame', 'self blame', 'it was my fault',
                'trust issues', 'difficulty trusting', 'hyperawareness', 'scanning for threats',
                'emotional flashbacks', 'somatic flashbacks', 'body memories', 'trauma responses',
                'fight or flight', 'freeze response', 'fawn response', 'trauma responses',
                'nervous system dysregulation', 'dysregulated', 'overwhelmed nervous system'
            ];
            
            const lowerText = decisionText.toLowerCase();
            let concernCount = 0;
            let crisisType = 'general';
            
            // Check for suicide keywords (highest priority)
            suicideKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 3; // Highest weight
                    crisisType = 'suicide';
                }
            });
            
            // Check for self-harm keywords (high priority)
            selfHarmKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 2;
                    if (crisisType === 'general') crisisType = 'self-harm';
                }
            });
            
            // Check for domestic violence keywords
            domesticViolenceKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 2;
                    if (crisisType === 'general') crisisType = 'domestic-violence';
                }
            });
            
            // Check for substance abuse keywords
            substanceAbuseKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 2;
                    if (crisisType === 'general') crisisType = 'substance-abuse';
                }
            });
            
            // Check for trauma keywords
            traumaKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 2;
                    if (crisisType === 'general') crisisType = 'trauma';
                }
            });
            
            // Check for eating disorder keywords
            eatingDisorderKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 2;
                    if (crisisType === 'general') crisisType = 'eating-disorder';
                }
            });
            
            // Check for crime victim keywords
            crimeVictimKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 1;
                    if (crisisType === 'general') crisisType = 'crime-victim';
                    console.log('Crime victim keyword detected:', keyword, 'in text:', lowerText);
                }
            });
            
            // Check for severe depression keywords
            severeDepressionKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) concernCount += 1;
            });
            
            // NEW: MEDICAL EMERGENCY DETECTION
            const medicalEmergencyKeywords = [
                'heart attack', 'chest pain', 'can\'t breathe', 'difficulty breathing', 'shortness of breath',
                'stroke symptoms', 'numbness', 'facial drooping', 'slurred speech', 'vision problems',
                'severe bleeding', 'uncontrollable bleeding', 'major injury', 'critical injury',
                'overdose emergency', 'drug overdose emergency', 'alcohol poisoning emergency',
                'seizure', 'convulsions', 'uncontrollable shaking', 'loss of consciousness',
                'fainting', 'passed out', 'unresponsive', 'not waking up', 'coma',
                'suicide attempt', 'attempted suicide', 'took pills', 'overdosed on pills',
                'self poisoning', 'chemical poisoning', 'carbon monoxide poisoning',
                'broken bones', 'compound fracture', 'severe burn', 'third degree burn',
                'head injury', 'traumatic brain injury', 'skull fracture', 'brain bleed',
                'severe allergic reaction', 'anaphylaxis', 'throat swelling', 'can\'t swallow',
                'diabetic emergency', 'diabetic coma', 'insulin shock', 'blood sugar emergency',
                'asthma attack', 'severe asthma', 'inhaler not working', 'can\'t breathe asthma'
            ];
            
            medicalEmergencyKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 3; // Highest priority - medical emergency
                    crisisType = 'medical-emergency';
                }
            });
            
            // NEW: HOMELESSNESS & HOUSING CRISIS DETECTION
            const homelessnessKeywords = [
                'homeless', 'no home', 'living on streets', 'sleeping in car', 'living in shelter',
                'evicted', 'eviction notice', 'facing eviction', 'about to be homeless',
                'no place to live', 'can\'t afford rent', 'rent overdue', 'behind on rent',
                'housing crisis', 'housing unstable', 'temporary housing', 'couch surfing',
                'living in tent', 'tent city', 'sleeping rough', 'street sleeping',
                'no fixed address', 'displaced', 'housing insecure', 'at risk of homelessness',
                'foreclosure', 'losing my home', 'bank taking my home', 'mortgage foreclosure',
                'kicked out', 'asked to leave', 'no family to stay with', 'nowhere to go',
                'living in my car', 'car living', 'vehicle dwelling', 'rv living'
            ];
            
            homelessnessKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 2;
                    if (crisisType === 'general') crisisType = 'homelessness';
                }
            });
            
            // NEW: FINANCIAL CRISIS DETECTION
            const financialCrisisKeywords = [
                'bankrupt', 'bankruptcy', 'filed bankruptcy', 'going bankrupt', 'debt crisis',
                'can\'t pay bills', 'bills overdue', 'utilities shut off', 'electricity shut off',
                'water shut off', 'gas shut off', 'phone shut off', 'internet shut off',
                'maxed out credit cards', 'credit card debt', 'overwhelming debt', 'debt collectors',
                'foreclosure', 'home foreclosure', 'car repossession', 'vehicle repossession',
                'can\'t afford food', 'no money for food', 'food insecurity', 'going hungry',
                'can\'t afford medicine', 'no money for medicine', 'medical debt', 'hospital bills',
                'payday loans', 'loan sharks', 'predatory lending', 'debt trap',
                'wage garnishment', 'bank levy', 'asset seizure', 'legal judgment',
                'unemployed', 'lost job', 'laid off', 'fired', 'no income'
            ];
            
            financialCrisisKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 1;
                    if (crisisType === 'general') crisisType = 'financial-crisis';
                }
            });
            
            // NEW: LONELINESS & SOCIAL ISOLATION DETECTION
            const lonelinessKeywords = [
                'completely alone', 'no friends', 'lonely', 'isolated', 'socially isolated',
                'no one to talk to', 'nobody understands', 'feel invisible', 'feel ignored',
                'social anxiety', 'afraid of people', 'avoiding people', 'social withdrawal',
                'no social support', 'no support system', 'cut off from family', 'disowned',
                'recluse', 'hermit', 'shut in', 'agoraphobia', 'afraid to leave house',
                'no one cares about me', 'nobody loves me', 'unloved', 'unwanted',
                'social outcast', 'excluded', 'ostracized', 'bullied', 'peer rejection',
                'empty house', 'silent home', 'living alone', 'no companionship',
                'depressed from loneliness', 'loneliness depression', 'isolated depression'
            ];
            
            lonelinessKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 1;
                    if (crisisType === 'general') crisisType = 'loneliness';
                }
            });
            
            // NEW: GAMBLING ADDICTION DETECTION
            const gamblingKeywords = [
                'gambling addiction', 'compulsive gambling', 'problem gambling', 'gambling problem',
                'can\'t stop gambling', 'gambling debt', 'lost everything gambling', 'gambling losses',
                'sports betting addiction', 'poker addiction', 'casino addiction', 'online gambling',
                'betting addiction', 'wagering addiction', 'gambling urge', 'gambling cravings',
                'chasing losses', 'trying to win back money', 'gambling to recover losses',
                'lying about gambling', 'hiding gambling', 'secret gambling', 'gambling in secret',
                'borrowing money to gamble', 'stealing to gamble', 'gambling with rent money',
                'gambling away savings', 'gambling away paycheck', 'gambling away inheritance',
                'gamblers anonymous', 'gambling therapy', 'gambling treatment', 'gambling help'
            ];
            
            gamblingKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 2;
                    if (crisisType === 'general') crisisType = 'gambling-addiction';
                }
            });
            
            // NEW: WORKPLACE BURNOUT & STRESS DETECTION
            const burnoutKeywords = [
                'burnout', 'work burnout', 'job burnout', 'career burnout', 'completely burned out',
                'work stress', 'job stress', 'work pressure', 'overwhelmed at work', 'work anxiety',
                'hate my job', 'can\'t stand my job', 'want to quit my job', 'job misery',
                'toxic workplace', 'toxic boss', 'abusive boss', 'workplace bullying', 'harassed at work',
                'working too much', 'overworked', 'workaholic', 'no work life balance',
                'career crisis', 'midlife career crisis', 'career change needed', 'stuck in career',
                'unemployment depression', 'job loss depression', 'can\'t find work', 'long term unemployed',
                'imposter syndrome', 'work anxiety', 'performance anxiety', 'fear of failure at work',
                'workplace discrimination', 'unfair treatment at work', 'passed over for promotion'
            ];
            
            burnoutKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 1;
                    if (crisisType === 'general') crisisType = 'burnout';
                }
            });
            
            // NEW: GRIEF & LOSS DETECTION
            const griefKeywords = [
                'grief', 'grieving', 'bereavement', 'mourning', 'death of loved one',
                'someone died', 'family member died', 'friend died', 'pet died', 'loss of pet',
                'recent death', 'sudden death', 'unexpected death', 'tragic death', 'violent death',
                'funeral', 'memorial service', 'coping with death', 'dealing with loss',
                'widow', 'widower', 'orphaned', 'lost my parents', 'lost my child',
                'miscarriage', 'stillbirth', 'pregnancy loss', 'infant loss', 'child loss',
                'suicide loss', 'lost someone to suicide', 'suicide bereavement',
                'anniversary of death', 'death anniversary', 'grief anniversary', 'grief triggers',
                'complicated grief', 'prolonged grief', 'traumatic grief', 'grief trauma',
                'lonely after loss', 'isolated by grief', 'grief depression', 'grief anxiety'
            ];
            
            griefKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 1;
                    if (crisisType === 'general') crisisType = 'grief';
                }
            });
            
            // NEW: CHRONIC ILLNESS & PAIN DETECTION
            const chronicIllnessKeywords = [
                'chronic pain', 'chronic illness', 'terminal illness', 'life limiting illness',
                'cancer diagnosis', 'terminal cancer', 'stage 4 cancer', 'advanced cancer',
                'multiple sclerosis', 'ms diagnosis', 'parkinson\'s disease', 'als diagnosis',
                'chronic fatigue syndrome', 'fibromyalgia', 'lupus', 'rheumatoid arthritis',
                'disability', 'disabled', 'wheelchair bound', 'chronic disability',
                'incurable disease', 'untreatable condition', 'progressive disease',
                'pain management', 'chronic pain management', 'opioid dependence', 'pain medication',
                'quality of life', 'palliative care', 'hospice care', 'end of life care',
                'medical bills', 'treatment costs', 'can\'t afford treatment', 'medical debt',
                'dealing with diagnosis', 'coping with illness', 'illness depression', 'sick depression'
            ];
            
            chronicIllnessKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 1;
                    if (crisisType === 'general') crisisType = 'chronic-illness';
                }
            });
            
            // NEW: RELATIONSHIP BREAKUP DETECTION
            const breakupKeywords = [
                'breakup', 'broken up', 'dumped me', 'left me', 'ended relationship',
                'divorce', 'divorced', 'getting divorced', 'separated', 'marriage ended',
                'heartbreak', 'heartbroken', 'broken heart', 'devastated by breakup',
                'cheated on me', 'infidelity', 'affair', 'betrayed', 'relationship betrayal',
                'lonely after breakup', 'alone after divorce', 'single again', 'starting over',
                'can\'t get over ex', 'still love my ex', 'missing my ex', 'ex won\'t leave me alone',
                'toxic ex', 'abusive ex', 'stalking ex', 'harassment from ex', 'controlling ex',
                'relationship trauma', 'breakup trauma', 'divorce trauma', 'betrayal trauma',
                'breakup depression', 'divorce depression', 'relationship grief', 'loss of love'
            ];
            
            breakupKeywords.forEach(keyword => {
                if (lowerText.includes(keyword)) {
                    concernCount += 1;
                    if (crisisType === 'general') crisisType = 'breakup';
                }
            });
            
            // Check for concerning phrases - BE MORE SPECIFIC
            const concerningPhrases = [
                'i want to die', 'i hate my life', 'i can\'t take it anymore',
                'i\'m done', 'i give up', 'no way out', 'end my suffering',
                'disappear forever', 'no hope left', 'can\'t live like this',
                'help me', 'emergency', 'need help now', 'in danger', 'unsafe'
            ];
            
            concerningPhrases.forEach(phrase => {
                if (lowerText.includes(phrase)) {
                    concernCount += 1;
                    console.log('üö® Concerning phrase detected:', phrase, 'in:', lowerText);
                }
            });
            
            // Store crisis type for specialized response
            if (concernCount >= 1) {
                localStorage.setItem('lastCrisisType', crisisType);
                console.log('Crisis detection details:', {
                    text: decisionText,
                    concernCount: concernCount,
                    crisisType: crisisType,
                    mood: mood
                });
            }
            
            // Trigger support if concerning content detected (lowered threshold for broader safety)
            const shouldTrigger = concernCount >= 1;
            console.log('Crisis detection result:', shouldTrigger, 'concernCount:', concernCount);
            return shouldTrigger;
        }

        // ENHANCED LOCATION-BASED CRISIS RESOURCES
        function getLocationBasedResources() {
            // Enhanced detection using multiple methods
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const language = navigator.language || navigator.userLanguage;
            const locale = navigator.language || 'en-US';
            
            // Try to get location from cookies/localStorage
            const savedLocation = localStorage.getItem('userLocation') || getCookie('userLocation');
            if (savedLocation) {
                return getResourcesByCountry(savedLocation);
            }
            
            // Try browser geolocation (with user permission)
            if (navigator.geolocation) {
                // This will be called asynchronously, but we'll use timezone/language as fallback
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const country = detectCountryFromCoordinates(position.coords.latitude, position.coords.longitude);
                        localStorage.setItem('userLocation', country);
                        setCookie('userLocation', country, 365);
                    },
                    error => {
                        console.log('Geolocation denied, using timezone/language detection');
                    }
                );
            }
            
            // Netherlands detection
            if (timezone.includes('Amsterdam') || timezone.includes('Europe/Amsterdam') || 
                locale.includes('nl') || language.includes('nl') || language.includes('dutch')) {
                return {
                    country: 'Netherlands',
                    primary: {
                        name: '113 Zelfmoordpreventie',
                        number: '113',
                        description: '24/7 crisis hotline for suicide prevention',
                        available: 'Available in Netherlands'
                    },
                    secondary: [
                        {
                            name: 'Huisartsenpost (GP Emergency)',
                            number: '0900-900-3333',
                            description: 'After-hours medical care',
                            available: 'Available in Netherlands'
                        },
                        {
                            name: 'Slachtofferhulp Nederland',
                            number: '0900-0101',
                            description: 'Victim support and crisis counseling',
                            available: 'Available in Netherlands'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // United Kingdom detection
            if (timezone.includes('London') || timezone.includes('Europe/London') || 
                locale.includes('gb') || language.includes('en-GB')) {
                return {
                    country: 'United Kingdom',
                    primary: {
                        name: 'Samaritans',
                        number: '116 123',
                        description: '24/7 emotional support',
                        available: 'Available in UK'
                    },
                    secondary: [
                        {
                            name: 'Shout Crisis Text Line',
                            number: '85258',
                            description: 'Text SHOUT to 85258',
                            available: 'Available in UK'
                        },
                        {
                            name: 'Papyrus HOPELINEUK',
                            number: '0800 068 4141',
                            description: 'For young people under 35',
                            available: 'Available in UK'
                        }
                    ],
                    emergency: '999',
                    textCrisis: true
                };
            }
            
            // Australia detection
            if (timezone.includes('Sydney') || timezone.includes('Melbourne') || timezone.includes('Australia/') || 
                locale.includes('au') || language.includes('en-AU')) {
                return {
                    country: 'Australia',
                    primary: {
                        name: 'Lifeline',
                        number: '13 11 14',
                        description: '24/7 crisis support and suicide prevention',
                        available: 'Available in Australia'
                    },
                    secondary: [
                        {
                            name: 'Suicide Call Back Service',
                            number: '1300 659 467',
                            description: 'Professional telephone counseling',
                            available: 'Available in Australia'
                        },
                        {
                            name: 'Kids Helpline',
                            number: '1800 55 1800',
                            description: 'For young people 5-25 years',
                            available: 'Available in Australia'
                        }
                    ],
                    emergency: '000',
                    textCrisis: false
                };
            }
            
            // Germany detection
            if (timezone.includes('Berlin') || timezone.includes('Europe/Berlin') || 
                locale.includes('de') || language.includes('de')) {
                return {
                    country: 'Germany',
                    primary: {
                        name: 'Telefonseelsorge',
                        number: '0800 111 0 111',
                        description: '24/7 emotional support and crisis counseling',
                        available: 'Available in Germany'
                    },
                    secondary: [
                        {
                            name: 'Nummer gegen Kummer',
                            number: '116 111',
                            description: 'For children and young people',
                            available: 'Available in Germany'
                        },
                        {
                            name: 'Sozialpsychiatrischer Dienst',
                            number: '0800 194 0100',
                            description: 'Psychiatric emergency service',
                            available: 'Available in Germany'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // France detection
            if (timezone.includes('Paris') || timezone.includes('Europe/Paris') || 
                locale.includes('fr') || language.includes('fr')) {
                return {
                    country: 'France',
                    primary: {
                        name: 'Suicide √âcoute',
                        number: '01 45 39 40 00',
                        description: '24/7 suicide prevention hotline',
                        available: 'Available in France'
                    },
                    secondary: [
                        {
                            name: 'SOS Amiti√©',
                            number: '01 45 39 40 00',
                            description: '24/7 emotional support',
                            available: 'Available in France'
                        },
                        {
                            name: 'Fil Sant√© Jeunes',
                            number: '0800 235 236',
                            description: 'For young people',
                            available: 'Available in France'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Canada detection
            if (timezone.includes('Toronto') || timezone.includes('Vancouver') || timezone.includes('America/') || 
                locale.includes('ca') || language.includes('en-CA')) {
                return {
                    country: 'Canada',
                    primary: {
                        name: '988 Suicide & Crisis Lifeline',
                        number: '988',
                        description: 'Call or text 988 (24/7, free, confidential)',
                        available: 'Available in Canada'
                    },
                    secondary: [
                        {
                            name: 'Crisis Services Canada',
                            number: '1-833-456-4566',
                            description: '24/7 crisis support',
                            available: 'Available in Canada'
                        },
                        {
                            name: 'Kids Help Phone',
                            number: '1-800-668-6868',
                            description: 'For young people',
                            available: 'Available in Canada'
                        }
                    ],
                    emergency: '911',
                    textCrisis: true
                };
            }
            
            // Spain detection
            if (timezone.includes('Madrid') || timezone.includes('Europe/Madrid') || 
                locale.includes('es') || language.includes('es') || language.includes('spanish')) {
                return {
                    country: 'Spain',
                    primary: {
                        name: 'Tel√©fono de la Esperanza',
                        number: '024',
                        description: '24/7 emotional support and crisis intervention',
                        available: 'Available in Spain'
                    },
                    secondary: [
                        {
                            name: 'Tel√©fono de la Esperanza Barcelona',
                            number: '93 300 25 25',
                            description: 'Crisis support in Barcelona',
                            available: 'Available in Spain'
                        },
                        {
                            name: 'SAPTEL (Servicio de Atenci√≥n Psicol√≥gica)',
                            number: '902 507 172',
                            description: 'Psychological support service',
                            available: 'Available in Spain'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Italy detection
            if (timezone.includes('Rome') || timezone.includes('Europe/Rome') || 
                locale.includes('it') || language.includes('it') || language.includes('italian')) {
                return {
                    country: 'Italy',
                    primary: {
                        name: 'Telefono Amico',
                        number: '800 86 00 22',
                        description: '24/7 emotional support and crisis prevention',
                        available: 'Available in Italy'
                    },
                    secondary: [
                        {
                            name: 'Samaritans Onlus',
                            number: '06 7720 6277',
                            description: 'Emotional support in Rome',
                            available: 'Available in Italy'
                        },
                        {
                            name: 'Telefono Azzurro',
                            number: '1.96.96',
                            description: 'For children and young people',
                            available: 'Available in Italy'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Belgium detection
            if (timezone.includes('Brussels') || timezone.includes('Europe/Brussels') || 
                locale.includes('be') || language.includes('nl-BE') || language.includes('fr-BE')) {
                return {
                    country: 'Belgium',
                    primary: {
                        name: 'Centrum ter preventie van zelfmoord',
                        number: '1813',
                        description: '24/7 suicide prevention hotline',
                        available: 'Available in Belgium'
                    },
                    secondary: [
                        {
                            name: 'Tele-Onthaal',
                            number: '106',
                            description: '24/7 emotional support',
                            available: 'Available in Belgium'
                        },
                        {
                            name: 'De Zelfmoordlijn',
                            number: '0800 32 123',
                            description: 'Suicide prevention support',
                            available: 'Available in Belgium'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Switzerland detection
            if (timezone.includes('Zurich') || timezone.includes('Europe/Zurich') || 
                locale.includes('ch') || language.includes('de-CH') || language.includes('fr-CH')) {
                return {
                    country: 'Switzerland',
                    primary: {
                        name: 'Die Dargebotene Hand',
                        number: '143',
                        description: '24/7 emotional support and crisis intervention',
                        available: 'Available in Switzerland'
                    },
                    secondary: [
                        {
                            name: 'La Main Tendue',
                            number: '022 321 21 21',
                            description: 'French-speaking crisis support',
                            available: 'Available in Switzerland'
                        },
                        {
                            name: 'Pro Juventute',
                            number: '147',
                            description: 'For children and young people',
                            available: 'Available in Switzerland'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Sweden detection
            if (timezone.includes('Stockholm') || timezone.includes('Europe/Stockholm') || 
                locale.includes('se') || language.includes('sv') || language.includes('swedish')) {
                return {
                    country: 'Sweden',
                    primary: {
                        name: 'Minds Sj√§lvmordslinje',
                        number: '90101',
                        description: '24/7 suicide prevention and crisis support',
                        available: 'Available in Sweden'
                    },
                    secondary: [
                        {
                            name: 'Jourhavande medm√§nniska',
                            number: '08-702 16 80',
                            description: '24/7 emotional support',
                            available: 'Available in Sweden'
                        },
                        {
                            name: 'BRIS (Children\'s Rights in Society)',
                            number: '116 111',
                            description: 'For children and young people',
                            available: 'Available in Sweden'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Norway detection
            if (timezone.includes('Oslo') || timezone.includes('Europe/Oslo') || 
                locale.includes('no') || language.includes('no') || language.includes('norwegian')) {
                return {
                    country: 'Norway',
                    primary: {
                        name: 'Mental Helse',
                        number: '116 123',
                        description: '24/7 mental health support and crisis intervention',
                        available: 'Available in Norway'
                    },
                    secondary: [
                        {
                            name: 'Kirkens SOS',
                            number: '22 40 00 40',
                            description: '24/7 emotional support',
                            available: 'Available in Norway'
                        },
                        {
                            name: 'Alarmtelefon for hjelp 113',
                            number: '113',
                            description: 'Medical emergency and crisis support',
                            available: 'Available in Norway'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Denmark detection
            if (timezone.includes('Copenhagen') || timezone.includes('Europe/Copenhagen') || 
                locale.includes('dk') || language.includes('da') || language.includes('danish')) {
                return {
                    country: 'Denmark',
                    primary: {
                        name: 'Livslinien',
                        number: '70 201 201',
                        description: '24/7 suicide prevention and crisis support',
                        available: 'Available in Denmark'
                    },
                    secondary: [
                        {
                            name: 'B√∏rneTelefonen',
                            number: '116 111',
                            description: 'For children and young people',
                            available: 'Available in Denmark'
                        },
                        {
                            name: 'Voksenmobil',
                            number: '70 20 20 20',
                            description: 'Adult crisis support',
                            available: 'Available in Denmark'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Finland detection
            if (timezone.includes('Helsinki') || timezone.includes('Europe/Helsinki') || 
                locale.includes('fi') || language.includes('fi') || language.includes('finnish')) {
                return {
                    country: 'Finland',
                    primary: {
                        name: 'Mieli ry Suicide Prevention',
                        number: '09 2525 0111',
                        description: '24/7 crisis support and suicide prevention',
                        available: 'Available in Finland'
                    },
                    secondary: [
                        {
                            name: 'Lasten ja nuorten puhelin',
                            number: '116 111',
                            description: 'For children and young people',
                            available: 'Available in Finland'
                        },
                        {
                            name: 'Sekasin-chat',
                            number: 'Chat available online',
                            description: 'Online crisis support chat',
                            available: 'Available in Finland'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Japan detection
            if (timezone.includes('Tokyo') || timezone.includes('Asia/Tokyo') || 
                locale.includes('jp') || language.includes('ja') || language.includes('japanese')) {
                return {
                    country: 'Japan',
                    primary: {
                        name: 'Inochi no Denwa',
                        number: '0570-783-556',
                        description: '24/7 life line and crisis support',
                        available: 'Available in Japan'
                    },
                    secondary: [
                        {
                            name: 'Tokyo Mental Health Support',
                            number: '03-5792-2730',
                            description: 'Mental health support in Tokyo',
                            available: 'Available in Japan'
                        },
                        {
                            name: 'Kokoro no Sodan',
                            number: '0120-461-997',
                            description: 'Counseling and support service',
                            available: 'Available in Japan'
                        }
                    ],
                    emergency: '119',
                    textCrisis: false
                };
            }
            
            // India detection
            if (timezone.includes('Kolkata') || timezone.includes('Asia/Kolkata') || 
                locale.includes('in') || language.includes('hi') || language.includes('indian')) {
                return {
                    country: 'India',
                    primary: {
                        name: 'iCall',
                        number: '9152987821',
                        description: '24/7 mental health helpline',
                        available: 'Available in India'
                    },
                    secondary: [
                        {
                            name: 'Sneha Foundation',
                            number: '91-44-24640050',
                            description: '24/7 crisis support in Chennai',
                            available: 'Available in India'
                        },
                        {
                            name: 'Sumaitri',
                            number: '91-11-23389010',
                            description: 'Crisis intervention center in Delhi',
                            available: 'Available in India'
                        }
                    ],
                    emergency: '112',
                    textCrisis: false
                };
            }
            
            // Brazil detection
            if (timezone.includes('Sao Paulo') || timezone.includes('America/Sao_Paulo') || 
                locale.includes('br') || language.includes('pt-BR') || language.includes('portuguese')) {
                return {
                    country: 'Brazil',
                    primary: {
                        name: 'CVV - Centro de Valoriza√ß√£o da Vida',
                        number: '188',
                        description: '24/7 suicide prevention and emotional support',
                        available: 'Available in Brazil'
                    },
                    secondary: [
                        {
                            name: 'CAPS (Centro de Aten√ß√£o Psicossocial)',
                            number: 'Dispon√≠vel localmente',
                            description: 'Local mental health centers',
                            available: 'Available in Brazil'
                        },
                        {
                            name: 'Sa√∫de Mental Brasil',
                            number: '0800 644 8282',
                            description: 'Mental health support line',
                            available: 'Available in Brazil'
                        }
                    ],
                    emergency: '192',
                    textCrisis: false
                };
            }
            
            // Mexico detection
            if (timezone.includes('Mexico City') || timezone.includes('America/Mexico_City') || 
                locale.includes('mx') || language.includes('es-MX')) {
                return {
                    country: 'Mexico',
                    primary: {
                        name: 'SAPTEL',
                        number: '47474747',
                        description: '24/7 psychological support and crisis intervention',
                        available: 'Available in Mexico'
                    },
                    secondary: [
                        {
                            name: 'Tel√©fono de la Esperanza M√©xico',
                            number: '5552598121',
                            description: 'Emotional support in Mexico City',
                            available: 'Available in Mexico'
                        },
                        {
                            name: 'Instituto Nacional de Psiquiatr√≠a',
                            number: '5541605706',
                            description: 'Psychiatric emergency services',
                            available: 'Available in Mexico'
                        }
                    ],
                    emergency: '911',
                    textCrisis: false
                };
            }
            
            // Argentina detection
            if (timezone.includes('Buenos Aires') || timezone.includes('America/Argentina/Buenos_Aires') || 
                locale.includes('ar') || language.includes('es-AR')) {
                return {
                    country: 'Argentina',
                    primary: {
                        name: 'Centro de Asistencia al Suicida',
                        number: '135',
                        description: '24/7 suicide prevention and crisis support',
                        available: 'Available in Argentina'
                    },
                    secondary: [
                        {
                            name: 'Tel√©fono de la Esperanza Buenos Aires',
                            number: '1353',
                            description: 'Emotional support in Buenos Aires',
                            available: 'Available in Argentina'
                        },
                        {
                            name: 'SAP Argentina',
                            number: '1353',
                            description: 'Psychological support service',
                            available: 'Available in Argentina'
                        }
                    ],
                    emergency: '911',
                    textCrisis: false
                };
            }
            
            // South Africa detection
            if (timezone.includes('Johannesburg') || timezone.includes('Africa/Johannesburg') || 
                locale.includes('za') || language.includes('en-ZA')) {
                return {
                    country: 'South Africa',
                    primary: {
                        name: 'Suicide Crisis Helpline',
                        number: '0800 567 567',
                        description: '24/7 suicide prevention and crisis support',
                        available: 'Available in South Africa'
                    },
                    secondary: [
                        {
                            name: 'Lifeline South Africa',
                            number: '0861 322 322',
                            description: '24/7 emotional support',
                            available: 'Available in South Africa'
                        },
                        {
                            name: 'South African Depression and Anxiety Group',
                            number: '0800 70 80 90',
                            description: 'Mental health support',
                            available: 'Available in South Africa'
                        }
                    ],
                    emergency: '10111',
                    textCrisis: false
                };
            }
            
            // New Zealand detection
            if (timezone.includes('Auckland') || timezone.includes('Pacific/Auckland') || 
                locale.includes('nz') || language.includes('en-NZ')) {
                return {
                    country: 'New Zealand',
                    primary: {
                        name: 'Lifeline New Zealand',
                        number: '0800 543 354',
                        description: '24/7 crisis support and suicide prevention',
                        available: 'Available in New Zealand'
                    },
                    secondary: [
                        {
                            name: 'Youthline New Zealand',
                            number: '0800 376 633',
                            description: 'Support for young people',
                            available: 'Available in New Zealand'
                        },
                        {
                            name: 'Suicide Crisis Helpline',
                            number: '0508 828 865',
                            description: '24/7 suicide prevention',
                            available: 'Available in New Zealand'
                        }
                    ],
                    emergency: '111',
                    textCrisis: false
                };
            }
            
            // Singapore detection
            if (timezone.includes('Singapore') || timezone.includes('Asia/Singapore') || 
                locale.includes('sg') || language.includes('en-SG')) {
                return {
                    country: 'Singapore',
                    primary: {
                        name: 'SOS Singapore',
                        number: '1-7674',
                        description: '24/7 suicide prevention and emotional support',
                        available: 'Available in Singapore'
                    },
                    secondary: [
                        {
                            name: 'Singapore Association for Mental Health',
                            number: '1800-283-7019',
                            description: 'Mental health support',
                            available: 'Available in Singapore'
                        },
                        {
                            name: 'Institute of Mental Health',
                            number: '6389-2222',
                            description: '24/7 mental health crisis line',
                            available: 'Available in Singapore'
                        }
                    ],
                    emergency: '995',
                    textCrisis: false
                };
            }
            
            // Default to US resources
            return {
                country: 'United States',
                primary: {
                    name: '988 Suicide & Crisis Lifeline',
                    number: '988',
                    description: 'Call or text 988 (24/7, free, confidential)',
                    available: 'Available in US & Canada'
                },
                secondary: [
                    {
                        name: 'Crisis Text Line',
                        number: 'Text HOME to 741741',
                        description: '24/7 crisis support via text',
                        available: 'Available in US & Canada'
                    },
                    {
                        name: 'National Suicide Prevention Lifeline',
                        number: '1-800-273-8255',
                        description: '24/7 free, confidential support',
                        available: 'Available in US'
                    },
                    {
                        name: 'Trevor Project',
                        number: '1-866-488-7386',
                        description: 'For LGBTQ+ youth',
                        available: 'Available in US'
                    }
                ],
                emergency: '911',
                textCrisis: true
            };
        }
        
        // Helper functions for enhanced location detection
        function getResourcesByCountry(country) {
            // This function returns resources for a specific country
            // Used when location is already known from cookies/geolocation
            switch(country.toLowerCase()) {
                case 'netherlands': return getLocationBasedResources().country === 'Netherlands' ? getLocationBasedResources() : getLocationBasedResources();
                case 'united kingdom': return getLocationBasedResources().country === 'United Kingdom' ? getLocationBasedResources() : getLocationBasedResources();
                // Add more cases as needed
                default: return getLocationBasedResources();
            }
        }
        
        function detectCountryFromCoordinates(lat, lon) {
            // Simplified coordinate-based detection
            // In a real implementation, you'd use a geocoding API
            if (lat > 50 && lat < 55 && lon > 3 && lon < 8) return 'Netherlands';
            if (lat > 50 && lat < 60 && lon > -10 && lon < 2) return 'United Kingdom';
            if (lat > -45 && lat < -10 && lon > 110 && lon < 155) return 'Australia';
            if (lat > 47 && lat < 55 && lon > 5 && lon < 15) return 'Germany';
            if (lat > 41 && lat < 51 && lon > -5 && lon < 10) return 'France';
            if (lat > 45 && lat < 60 && lon > -140 && lon < -50) return 'Canada';
            if (lat > 25 && lat < 50 && lon > -125 && lon < -65) return 'United States';
            if (lat > 35 && lat < 45 && lon > -10 && lon < 5) return 'Spain';
            if (lat > 35 && lat < 47 && lon > 6 && lon < 19) return 'Italy';
            if (lat > 49 && lat < 52 && lon > 2 && lon < 7) return 'Belgium';
            if (lat > 45 && lat < 48 && lon > 5 && lon < 11) return 'Switzerland';
            if (lat > 55 && lat < 70 && lon > 10 && lon < 25) return 'Sweden';
            if (lat > 57 && lat < 72 && lon > 4 && lon < 32) return 'Norway';
            if (lat > 54 && lat < 58 && lon > 8 && lon < 15) return 'Denmark';
            if (lat > 59 && lat < 70 && lon > 20 && lon < 32) return 'Finland';
            if (lat > 30 && lat < 46 && lon > 129 && lon < 146) return 'Japan';
            if (lat > 8 && lat < 37 && lon > 68 && lon < 98) return 'India';
            if (lat > -35 && lat < 5 && lon > -75 && lon < -35) return 'Brazil';
            if (lat > 14 && lat < 33 && lon > -118 && lon < -86) return 'Mexico';
            if (lat > -55 && lat < -21 && lon < -53) return 'Argentina';
            if (lat > -35 && lat < -22 && lon > 16 && lon < 33) return 'South Africa';
            if (lat > -47 && lat < -34 && lon > 165 && lon < 179) return 'New Zealand';
            if (lat > 1 && lat < 2 && lon > 103 && lon < 105) return 'Singapore';
            return 'United States'; // Default fallback
        }
        
        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = name + '=' + value + ';expires=' + expires.toUTCString() + ';path=/';
        }
        
        function getCookie(name) {
            const nameEQ = name + '=';
            const ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }
        
        // CRISIS-SPECIFIC CONTENT GENERATION
        function getCrisisSpecificContent(crisisType, resources) {
            const content = {
                'suicide': {
                    icon: 'üõë',
                    title: 'Suicide Prevention Support',
                    subtitle: 'You are not alone. Help is available 24/7.',
                    specializedIcon: 'üíô',
                    specializedTitle: 'Specialized Suicide Prevention',
                    specializedResources: [
                        {
                            name: '988 Suicide & Crisis Lifeline',
                            number: '988',
                            description: '24/7 free, confidential support for people in distress',
                            available: 'Available in US & Canada'
                        },
                        {
                            name: 'Crisis Text Line',
                            number: 'Text HOME to 741741',
                            description: 'Text with a trained crisis counselor',
                            available: 'Available in US & Canada'
                        }
                    ]
                },
                'domestic-violence': {
                    icon: 'üõ°Ô∏è',
                    title: 'Domestic Violence Support',
                    subtitle: 'You deserve to be safe. Help is available right now.',
                    specializedIcon: 'üè†',
                    specializedTitle: 'Domestic Violence Hotlines',
                    specializedResources: [
                        {
                            name: 'National Domestic Violence Hotline',
                            number: '1-800-799-7233',
                            description: '24/7 confidential support for domestic violence victims',
                            available: 'Available in US'
                        },
                        {
                            name: 'The Hotline (Domestic Violence)',
                            number: 'Text START to 88788',
                            description: 'Text-based support for domestic violence situations',
                            available: 'Available in US'
                        },
                        {
                            name: 'Women\'s Aid (UK)',
                            number: '0808 2000 247',
                            description: '24/7 domestic abuse helpline',
                            available: 'Available in UK'
                        }
                    ]
                },
                'substance-abuse': {
                    icon: 'üíä',
                    title: 'Substance Abuse & Addiction Support',
                    subtitle: 'Recovery is possible. Help is just a call away.',
                    specializedIcon: 'üîÑ',
                    specializedTitle: 'Addiction & Recovery Support',
                    specializedResources: [
                        {
                            name: 'SAMHSA National Helpline',
                            number: '1-800-662-4357',
                            description: '24/7 treatment referral and information service',
                            available: 'Available in US'
                        },
                        {
                            name: 'Narcotics Anonymous',
                            number: '1-800-778-6278',
                            description: 'Fellowship for people recovering from drug addiction',
                            available: 'Available in US'
                        },
                        {
                            name: 'Alcoholics Anonymous',
                            number: 'Find local meetings online',
                            description: 'Fellowship for people recovering from alcoholism',
                            available: 'Available worldwide'
                        }
                    ]
                },
                'trauma': {
                    icon: 'üß†',
                    title: 'Trauma & PTSD Support',
                    subtitle: 'Healing is possible. You don\'t have to go through this alone.',
                    specializedIcon: 'üå±',
                    specializedTitle: 'Trauma Support Services',
                    specializedResources: [
                        {
                            name: 'National Center for PTSD',
                            number: '1-800-273-8255',
                            description: 'Information and resources for PTSD treatment',
                            available: 'Available in US'
                        },
                        {
                            name: 'RAINN (Sexual Assault)',
                            number: '1-800-656-4673',
                            description: '24/7 sexual assault hotline',
                            available: 'Available in US'
                        },
                        {
                            name: 'Crisis Text Line',
                            number: 'Text HOME to 741741',
                            description: 'Support for trauma and crisis situations',
                            available: 'Available in US & Canada'
                        }
                    ]
                },
                'eating-disorder': {
                    icon: 'üçΩÔ∏è',
                    title: 'Eating Disorder Support',
                    subtitle: 'You deserve a healthy relationship with food and your body.',
                    specializedIcon: 'üíö',
                    specializedTitle: 'Eating Disorder Helplines',
                    specializedResources: [
                        {
                            name: 'National Eating Disorders Helpline',
                            number: '1-800-931-2237',
                            description: '24/7 support and resources for eating disorders',
                            available: 'Available in US'
                        },
                        {
                            name: 'Beat (UK Eating Disorders)',
                            number: '0808 801 0677',
                            description: 'Adult helpline for eating disorders',
                            available: 'Available in UK'
                        },
                        {
                            name: 'Butterfly Foundation (Australia)',
                            number: '1800 33 4673',
                            description: 'Support for eating disorders and body image issues',
                            available: 'Available in Australia'
                        }
                    ]
                },
                'self-harm': {
                    icon: '‚ö†Ô∏è',
                    title: 'Self-Harm Support',
                    subtitle: 'There are healthier ways to cope. Help is available.',
                    specializedIcon: 'üíù',
                    specializedTitle: 'Self-Harm Recovery Support',
                    specializedResources: [
                        {
                            name: 'Self-Harm Hotline',
                            number: '1-800-273-8255',
                            description: '24/7 support for self-harm and crisis situations',
                            available: 'Available in US'
                        },
                        {
                            name: 'YoungMinds (UK)',
                            number: '0808 802 5544',
                            description: 'Support for young people who self-harm',
                            available: 'Available in UK'
                        },
                        {
                            name: 'Kids Helpline (Australia)',
                            number: '1800 55 1800',
                            description: 'Support for young people dealing with self-harm',
                            available: 'Available in Australia'
                        }
                    ]
                },
                'crime-victim': {
                    icon: 'üöî',
                    title: 'Crime Victim Support',
                    subtitle: 'You are not to blame. Support and resources are available.',
                    specializedIcon: '‚öñÔ∏è',
                    specializedTitle: 'Victim Support Services',
                    specializedResources: [
                        {
                            name: 'VictimConnect Resource Center',
                            number: '1-855-4-VICTIM (1-855-484-2846)',
                            description: '24/7 referral service for crime victims',
                            available: 'Available in US'
                        },
                        {
                            name: 'National Center for Victims of Crime',
                            number: '1-855-4-VICTIM',
                            description: 'Support and resources for crime victims',
                            available: 'Available in US'
                        },
                        {
                            name: 'Victim Support (UK)',
                            number: '0808 1689 111',
                            description: 'Free and confidential support for victims of crime',
                            available: 'Available in England & Wales'
                        }
                    ]
                },
                'medical-emergency': {
                    icon: 'üöë',
                    title: 'Medical Emergency - Call 911 Now',
                    subtitle: 'This appears to be a medical emergency. Call emergency services immediately.',
                    specializedIcon: '‚öïÔ∏è',
                    specializedTitle: 'Emergency Medical Services',
                    specializedResources: [
                        {
                            name: 'Emergency Services',
                            number: 'Call 911 or 112',
                            description: 'Immediate medical emergency response',
                            available: 'Available worldwide'
                        },
                        {
                            name: 'Poison Control',
                            number: '1-800-222-1222',
                            description: '24/7 poison emergency hotline',
                            available: 'Available in US'
                        }
                    ]
                },
                'homelessness': {
                    icon: 'üè†',
                    title: 'Housing Crisis Support',
                    subtitle: 'Help is available for housing and shelter needs.',
                    specializedIcon: 'üõèÔ∏è',
                    specializedTitle: 'Housing & Shelter Resources',
                    specializedResources: [
                        {
                            name: 'National Homeless Hotline',
                            number: '2-1-1',
                            description: '24/7 referral for housing and shelter services',
                            available: 'Available in US'
                        },
                        {
                            name: 'Housing Crisis Hotline',
                            number: '1-800-548-6087',
                            description: 'Emergency housing assistance',
                            available: 'Available in US'
                        }
                    ]
                },
                'financial-crisis': {
                    icon: 'üí∞',
                    title: 'Financial Crisis Support',
                    subtitle: 'Financial help and debt relief resources are available.',
                    specializedIcon: 'üí≥',
                    specializedTitle: 'Financial Assistance Services',
                    specializedResources: [
                        {
                            name: 'National Debt Helpline',
                            number: '1-800-388-2227',
                            description: 'Free financial counseling and debt help',
                            available: 'Available in US'
                        },
                        {
                            name: '211 United Way',
                            number: '2-1-1',
                            description: 'Referral for financial assistance programs',
                            available: 'Available in US & Canada'
                        }
                    ]
                },
                'loneliness': {
                    icon: 'üë•',
                    title: 'Loneliness & Isolation Support',
                    subtitle: 'You don\'t have to be alone. Connection is possible.',
                    specializedIcon: 'üí¨',
                    specializedTitle: 'Social Connection Resources',
                    specializedResources: [
                        {
                            name: 'Crisis Chat',
                            number: 'Online chat available',
                            description: '24/7 online emotional support',
                            available: 'Available worldwide'
                        },
                        {
                            name: 'Warm Line',
                            number: '1-855-276-8255',
                            description: 'Non-crisis emotional support line',
                            available: 'Available in US'
                        }
                    ]
                },
                'gambling-addiction': {
                    icon: 'üé∞',
                    title: 'Gambling Addiction Support',
                    subtitle: 'Help is available for gambling problems.',
                    specializedIcon: 'üé≤',
                    specializedTitle: 'Gambling Recovery Services',
                    specializedResources: [
                        {
                            name: 'National Problem Gambling Helpline',
                            number: '1-800-522-4700',
                            description: '24/7 confidential gambling problem support',
                            available: 'Available in US'
                        },
                        {
                            name: 'Gamblers Anonymous',
                            number: 'Find meetings online',
                            description: 'Fellowship for gambling addiction recovery',
                            available: 'Available worldwide'
                        }
                    ]
                },
                'burnout': {
                    icon: 'üíº',
                    title: 'Workplace Burnout Support',
                    subtitle: 'Career and workplace stress resources are available.',
                    specializedIcon: '‚öñÔ∏è',
                    specializedTitle: 'Career & Workplace Support',
                    specializedResources: [
                        {
                            name: 'Career Counseling Hotline',
                            number: '1-800-342-5627',
                            description: 'Career guidance and job search support',
                            available: 'Available in US'
                        },
                        {
                            name: 'Workplace Harassment Hotline',
                            number: '1-800-955-5605',
                            description: 'Workplace rights and harassment support',
                            available: 'Available in US'
                        }
                    ]
                },
                'grief': {
                    icon: 'üíî',
                    title: 'Grief & Loss Support',
                    subtitle: 'Grief is a journey. You don\'t have to walk it alone.',
                    specializedIcon: 'üïäÔ∏è',
                    specializedTitle: 'Bereavement Support Services',
                    specializedResources: [
                        {
                            name: 'Grief Support Hotline',
                            number: '1-800-423-5663',
                            description: '24/7 grief counseling and support',
                            available: 'Available in US'
                        },
                        {
                            name: 'The Compassionate Friends',
                            number: '1-877-969-0010',
                            description: 'Support for families after child death',
                            available: 'Available in US'
                        }
                    ]
                },
                'chronic-illness': {
                    icon: 'üè•',
                    title: 'Chronic Illness Support',
                    subtitle: 'Living with chronic illness is challenging. Support is available.',
                    specializedIcon: 'üíä',
                    specializedTitle: 'Chronic Condition Resources',
                    specializedResources: [
                        {
                            name: 'Chronic Illness Support',
                            number: '1-800-363-3063',
                            description: 'Support for people with chronic conditions',
                            available: 'Available in US'
                        },
                        {
                            name: 'Patient Advocate Foundation',
                            number: '1-800-532-5274',
                            description: 'Help with medical costs and insurance',
                            available: 'Available in US'
                        }
                    ]
                },
                'breakup': {
                    icon: 'üíî',
                    title: 'Relationship Breakup Support',
                    subtitle: 'Heartbreak hurts. Healing is possible with support.',
                    specializedIcon: '‚ù§Ô∏è‚Äçü©π',
                    specializedTitle: 'Relationship Support Services',
                    specializedResources: [
                        {
                            name: 'Relationship Support Hotline',
                            number: '1-800-799-7233',
                            description: 'Support for relationship issues and breakups',
                            available: 'Available in US'
                        },
                        {
                            name: 'Divorce Care Support',
                            number: 'Find groups online',
                            description: 'Support groups for divorce and separation',
                            available: 'Available worldwide'
                        }
                    ]
                },
                'general': {
                    icon: 'üõë',
                    title: 'Immediate Support Available',
                    subtitle: 'You\'re not alone. Help is here right now.',
                    specializedResources: null
                }
            };
            
            return content[crisisType] || content['general'];
        }

        // TEST FUNCTION FOR DEBUGGING
function testCrisisDetection() {
    const testText = "shooting";
    const testMood = 5;
    console.log('Testing crisis detection with:', testText);
    const result = detectCrisis(testText, testMood);
    console.log('Test result:', result);
    console.log('Detected crisis type:', localStorage.getItem('lastCrisisType'));
}

function showCrisisSupport() {
    console.log('üö® showCrisisSupport() STARTED');
    
    const resources = getLocationBasedResources();
    const crisisType = localStorage.getItem('lastCrisisType') || 'general';
    
    console.log('üìç Crisis type:', crisisType);
    console.log('üåç Resources:', resources);
    
    // Get specialized content based on crisis type
    const crisisContent = getCrisisSpecificContent(crisisType, resources);
    console.log('üìã Crisis content:', crisisContent);
    console.log('üé® About to create modal...');
    
    // Create modal with proper styling
    const modal = document.createElement('div');
    modal.id = 'crisis-overlay';
    modal.className = 'crisis-support-overlay';
    
    modal.innerHTML = `
        <div class="crisis-support-modal glow-effect">
            <div class="crisis-header">
                <h2>${crisisContent.icon} ${crisisContent.title}</h2>
                <p>${crisisContent.subtitle}</p>
                <p><strong>üìç Detected Location: ${resources.country}</strong></p>
            </div>
            
            <div class="crisis-options">
                <div class="crisis-option">
                    <h3>üìû Primary Crisis Line</h3>
                    <div class="hotline-list">
                        <div class="hotline-item primary-hotline">
                            <strong>${resources.primary.name}</strong><br>
                            ${resources.primary.number}<br>
                            <em>${resources.primary.description}</em><br>
                            <small>${resources.primary.available}</small>
                        </div>
                    </div>
                </div>
                
                <div class="crisis-option">
                    <h3>üÜò Additional Support</h3>
                    <div class="hotline-list">
                        ${resources.secondary.map(service => `
                            <div class="hotline-item">
                                <strong>${service.name}</strong><br>
                                ${service.number}<br>
                                <em>${service.description}</em><br>
                                <small>${service.available}</small>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                ${crisisContent.specializedResources ? `
                    <div class="crisis-option">
                        <h3>${crisisContent.specializedIcon} ${crisisContent.specializedTitle}</h3>
                        <div class="hotline-list">
                            ${crisisContent.specializedResources.map(resource => `
                                <div class="hotline-item specialized">
                                    <strong>${resource.name}</strong><br>
                                    ${resource.number}<br>
                                    <em>${resource.description}</em><br>
                                    <small>${resource.available}</small>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            </div>
            
            <div class="crisis-immediate-actions">
                <h3>‚ö° Immediate Actions You Can Take</h3>
                <div class="action-list">
                    <div class="action-item">
                        <strong>üö® Call ${resources.emergency} or go to nearest emergency room</strong><br>
                        <small>If you're in immediate danger</small>
                    </div>
                    <div class="action-item">
                        <strong>üë• Reach out to someone you trust</strong><br>
                        <small>Friend, family member, teacher, coworker</small>
                    </div>
                    <div class="action-item">
                        <strong>üè• Contact a mental health professional</strong><br>
                        <small>Therapist, counselor, psychiatrist</small>
                    </div>
                    <div class="action-item">
                        <strong>üìç Remove access to means of self-harm</strong><br>
                        <small>Ask someone to help if needed</small>
                    </div>
                </div>
            </div>
            
            <div class="hope-messages">
                <div class="hope-message">"You are stronger than you know."</div>
                <div class="hope-message">"This too shall pass."</div>
                <div class="hope-message">"You are worthy of help and support."</div>
                <div class="hope-message">"Tomorrow can be different."</div>
            </div>
            
            <div class="crisis-actions">
                <button class="cyber-button" onclick="callCrisisLine('${resources.primary.number}')">üìû Call ${resources.primary.name}</button>
                ${resources.textCrisis ? `<button class="cyber-button" onclick="textCrisisLine()">üí¨ Text Crisis Line</button>` : ''}
                <button class="cyber-button" onclick="closeCrisisSupport()">Continue to App</button>
            </div>
            
            <div class="crisis-disclaimer">
                <p><strong>Important:</strong> This app is not a substitute for professional medical care. If you're having thoughts of harming yourself, please reach out to a healthcare professional or call emergency services immediately.</p>
            </div>
        </div>
    `;
    
    // Remove existing modal
    const existingModal = document.getElementById('crisis-overlay');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add new modal
    console.log('üì¶ About to append modal to body...');
    document.body.appendChild(modal);
    console.log('‚úÖ Modal appended to DOM');
    
    // Add class to body for CSS targeting
    document.body.classList.add('crisis-modal-open');
    console.log('üè∑Ô∏è Added crisis-modal-open class to body');
    
    // FORCE DISPLAY WITH INLINE STYLES
    modal.style.display = 'flex';
    modal.style.visibility = 'visible';
    modal.style.opacity = '1';
    modal.style.zIndex = '999999';
    console.log('üé® Applied inline styles to modal');
    
    // Check if modal is actually visible
    const computedStyle = window.getComputedStyle(modal);
    console.log('üîç Modal computed style:', computedStyle.display);
    console.log('üîç Modal visibility:', computedStyle.visibility);
    console.log('üîç Modal opacity:', computedStyle.opacity);
    
    // Add escape key listener to close modal
    const escapeHandler = (e) => {
        if (e.key === 'Escape') {
            closeCrisisSupport();
        }
    };
    document.addEventListener('keydown', escapeHandler);
    // Store reference for cleanup
    closeCrisisSupport.escapeHandler = escapeHandler;
    
    console.log('üéØ Crisis modal setup complete!');
    console.log('üìä Modal element:', modal);
}

        function callCrisisLine(number) {
    window.location.href = `tel:${number}`;
}

function textCrisisLine() {
    window.location.href = 'sms:741741';
}

function closeCrisisSupport() {
    const overlay = document.getElementById('crisis-overlay');
    if (overlay) {
        overlay.remove();
        // Remove class to restore scrolling
        document.body.classList.remove('crisis-modal-open');
        // Remove escape key listener (cleanup)
        if (closeCrisisSupport.escapeHandler) {
            document.removeEventListener('keydown', closeCrisisSupport.escapeHandler);
        }
        console.log('Modal closed, scrolling restored');
    }
}

        // Add crisis support styles
        const crisisStyles = `
            <style>
                .crisis-support-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.9);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    animation: fadeIn 0.3s ease-out;
                }
                
                .crisis-support-modal {
                    background: linear-gradient(135deg, #ffffff, #f8f9fa);
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 800px;
                    max-height: 90vh;
                    overflow-y: auto;
                    margin: 20px;
                    border: 3px solid #667eea;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                }
                
                .crisis-header {
                    text-align: center;
                    margin-bottom: 30px;
                    padding-bottom: 20px;
                    border-bottom: 2px solid #e0e0e0;
                }
                
                .crisis-header h2 {
                    color: #dc3545;
                    font-size: 2em;
                    margin-bottom: 10px;
                }
                
                .crisis-header p {
                    font-size: 1.2em;
                    color: #333;
                }
                
                .crisis-options {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 30px;
                    margin-bottom: 30px;
                }
                
                @media (max-width: 768px) {
                    .crisis-options {
                        grid-template-columns: 1fr;
                    }
                }
                
                .crisis-option {
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 15px;
                    border-left: 4px solid #667eea;
                }
                
                .crisis-option h3 {
                    color: #333;
                    margin-bottom: 15px;
                }
                
                .hotline-list {
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                }
                
                .hotline-item {
                    padding: 15px;
                    background: white;
                    border-radius: 10px;
                    border: 1px solid #e0e0e0;
                }
                
                .hotline-item strong {
                    color: #667eea;
                    font-size: 1.1em;
                }
                
                .primary-hotline {
                    background: linear-gradient(135deg, #dc3545, #c82333);
                    color: white;
                    border: 2px solid #dc3545;
                }
                
                .primary-hotline strong {
                    color: white;
                    font-size: 1.2em;
                }
                
                .primary-hotline em,
                .primary-hotline small {
                    color: rgba(255, 255, 255, 0.9);
                }
                
                .specialized {
                    background: linear-gradient(135deg, #6f42c1, #5a32a3);
                    color: white;
                    border: 2px solid #6f42c1;
                }
                
                .specialized strong {
                    color: white;
                    font-size: 1.1em;
                }
                
                .specialized em,
                .specialized small {
                    color: rgba(255, 255, 255, 0.9);
                }
                
                .hotline-item small {
                    color: #666;
                    font-style: italic;
                }
                
                .crisis-immediate-actions {
                    background: #fff3cd;
                    padding: 25px;
                    border-radius: 15px;
                    border-left: 4px solid #ffc107;
                    margin-bottom: 30px;
                }
                
                .crisis-immediate-actions h3 {
                    color: #856404;
                    margin-bottom: 15px;
                }
                
                .action-list {
                    display: grid;
                    gap: 15px;
                }
                
                .action-item {
                    padding: 15px;
                    background: white;
                    border-radius: 10px;
                    border: 1px solid #ffc107;
                }
                
                .action-item strong {
                    color: #dc3545;
                }
                
                .crisis-hope {
                    background: linear-gradient(135deg, #d4edda, #c3e6cb);
                    padding: 25px;
                    border-radius: 15px;
                    border-left: 4px solid #28a745;
                    margin-bottom: 30px;
                    text-align: center;
                }
                
                .crisis-hope h3 {
                    color: #155724;
                    margin-bottom: 15px;
                }
                
                .hope-messages {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 15px;
                    margin-top: 20px;
                }
                
                .hope-message {
                    padding: 15px;
                    background: white;
                    border-radius: 10px;
                    border: 1px solid #28a745;
                    font-style: italic;
                    color: #155724;
                    text-align: center;
                }
                
                .crisis-actions {
                    display: flex;
                    gap: 15px;
                    justify-content: center;
                    margin-bottom: 30px;
                    flex-wrap: wrap;
                }
                
                .crisis-actions button {
                    padding: 15px 30px;
                    font-size: 16px;
                    font-weight: 600;
                }
                
                .crisis-disclaimer {
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 10px;
                    border: 1px solid #e0e0e0;
                    font-size: 0.9em;
                    color: #666;
                }
                
                .crisis-disclaimer strong {
                    color: #333;
                }
                
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
            </style>
        `;
        
        document.head.insertAdjacentHTML('beforeend', crisisStyles);

        // Load initial data
        updateStatistics();
        updateTimeLog();
    </script>
</body>
</html>
